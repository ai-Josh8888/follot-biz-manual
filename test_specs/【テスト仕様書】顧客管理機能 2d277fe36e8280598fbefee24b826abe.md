# 【テスト仕様書】顧客管理機能

## 基本情報

- **作成日**: 2025 年 12 月 23 日
- **最終更新日**: 2026 年 1 月 5 日 (FB/429 対応)
- **対象バージョン**: リリース前最終版
- **テスト対象**: 顧客の検索、閲覧、登録、編集、削除、および関連機能
- **関連実装**:
    - `src/components/environments/CustomersManager/index.tsx`
    - `src/components/ecosystems/Customers/index.tsx`
    - `src/components/ecosystems/Customers/CustomerFormModal.tsx`
    - `src/components/ecosystems/Customers/CustomerProfile.tsx`
    - `src/components/ecosystems/Customers/CustomerTable/`
    - `src/components/ecosystems/Customers/Filter/`

---

## 2. 顧客管理機能 (/customers)

### 基本情報

- **URL**: `/customers`
- **コンポーネント**: `src/components/environments/CustomersManager/`
- **機能概要**: 顧客情報の管理（一覧表示、詳細閲覧、新規登録、編集、削除）を行う機能

### データ構造

- **Customer**:
    - `name`: string - 顧客名（必須）
    - `nameKana`: string - 顧客名かな
    - `companyName`: string - 会社名
    - `companyNameKana`: string - 会社名かな
    - `tel`: string - 電話番号
    - `address`: string - 住所
    - `leadScore`: number - 見込み度 (10=A, 20=B, 30=C, 40=D, 99=未設定)
    - `contactDetails`: array - 利用連絡ツール詳細 (Email, LINE, Chatwork)
    - `contactTypes`: array - 利用連絡ツール種別の配列 ('email'|'line'|'chatwork')
    - `firstInquiryDate`: Timestamp - 初回問合せ日
    - `latestMessageDate`: Timestamp - 最終問合せ日
    - `memo`: string - メモ
    - `supervisor`: object - お客様担当ユーザー情報
    - `user`: object - 連携済みのアカウント情報
    - `createdAt`: Timestamp - 作成日時
    - `updatedAt`: Timestamp - 更新日時

### テスト項目

### 1. UI 表示テスト (UI)

| 項目 ID | 確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| CUST-UI-001 | ページアクセス | ヘッダー「顧客管理」、サイドバー、顧客一覧パネルが表示される |  |  |  |  |
| CUST-UI-002 | アクションバー表示 | 「並び替え」ドロップダウン、「フィルター」ボタンが表示される |  |  |  |  |
| CUST-UI-003 | 顧客一覧表示 | 登録済みの顧客がテーブル形式で表示される（氏名、見込み度、初回問合せ日/最終問合せ日、お客様担当、利用連絡ツール、タスク、電話番号、MEMO） |  |  |  |  |
| CUST-UI-004 | 新規登録ボタン | サイドバーに「新規登録」ボタン（＋アイコン等）が表示される |  |  |  |  |
| CUST-UI-005 | 利用連絡ツールアイコン | 一覧・詳細で利用連絡ツールがアイコン（メール/LINE/Chatwork）で表示される |  |  |  |  |

### 2. 機能テスト (FUNC)

| 項目 ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| CUST-FUNC-001 | 新規登録モーダル表示 | 「新規登録」ボタンをクリックすると、空の入力フォームを持つモーダルが表示される |  |  |  |  |
| CUST-FUNC-002 | 新規顧客登録（必須のみ） | 名前のみ入力して「作成」をクリックすると、顧客が作成され一覧に追加される |  |  |  |  |
| CUST-FUNC-003 | 新規顧客登録（全項目） | 全てのフィールドを入力して「作成」をクリックすると、全ての情報が正しく保存される |  |  |  |  |
| CUST-FUNC-004 | 顧客詳細表示 | 一覧の任意の顧客をクリックすると、右側に詳細パネルが表示される |  |  |  |  |
| CUST-FUNC-005 | 顧客編集モーダル表示 | 詳細パネルの「編集」ボタンをクリックすると、現在の情報が入力された状態でモーダルが表示される |  |  |  |  |
| CUST-FUNC-006 | 顧客情報更新 | 情報を変更して「更新」をクリックすると、一覧および詳細パネルの情報が更新される |  |  |  |  |
| CUST-FUNC-007 | 顧客削除 | 編集モーダル内の「削除」ボタンをクリックし、確認ダイアログで承認すると、顧客が削除され一覧から消える |  |  |  |  |
| CUST-FUNC-008 | 利用連絡ツール追加 | フォームで「＋利用連絡ツールを追加」をクリックし、Type を選択して値を入力できる |  |  |  |  |
| CUST-FUNC-009 | 利用連絡ツール削除 | フォームで利用連絡ツールのゴミ箱アイコンをクリックすると、その行が削除される |  |  |  |  |
| CUST-FUNC-010 | お客様担当設定 | お客様担当プルダウンからユーザーを選択・保存できる |  |  |  |  |
| CUST-FUNC-011 | 見込み度設定 | 見込み度プルダウンから A〜D ランクを選択・保存できる |  |  |  |  |
| CUST-FUNC-012 | フィルター機能 | フィルターボタンから条件を指定し、一覧が絞り込まれる。フィルター項目：利用連絡ツール、初回問合せ日（開始日・終了日）、最終問合せ日（開始日・終了日）、電話番号、住所、見込み度、お客様担当 |  |  |  |  |
| CUST-FUNC-013 | 並び替え機能 | アクションバーまたはサイドバーで並び順を切り替え、一覧の順序が変わる。並び順：新しい順、古い順、見込み度の高い順、見込み度の低い順、最終問合せ日の新しい順、最終問合せ日の古い順 |  |  |  |  |
| CUST-FUNC-014 | サイドバー・ActionBar 並び順同期 | サイドバーで並び順を変更すると、ActionBar のドロップダウン表示も同期される |  |  |  |  |

### 3. バリデーションテスト (VAL)

| 項目 ID | 入力値 | 操作 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| CUST-VAL-001 | 名前空欄 | 新規作成/更新 | 「名前を入力してください」等のエラーが表示され、保存できない |  |  |  |  |
| CUST-VAL-002 | メールアドレス形式不正 | 利用連絡ツールで Email を選択し不正な形式を入力 | 保存時にエラーまたは警告が表示される（実装依存） |  |  |  |  |

### 4. 権限テスト (AUTH)

| 項目 ID | ユーザーロール | 操作/確認箇所 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| CUST-AUTH-001 | User | 顧客一覧アクセス | 一覧が表示される |  |  |  |  |
| CUST-AUTH-002 | User | 顧客詳細アクセス | 詳細パネルが表示される (`customer:visit`) |  |  |  |  |
| CUST-AUTH-003 | User | 顧客編集 | 編集ボタンが表示され、編集・保存が可能 (`customer:edit`) |  |  |  |  |
| CUST-AUTH-004 | User | 顧客削除 | 編集モーダルに削除ボタンが表示され、削除が可能 (`customer:delete`) |  |  |  |  |
| CUST-AUTH-005 | Guest | 顧客一覧アクセス | 権限エラーまたはアクセス不可（リダイレクト等） |  |  |  |  |

### 5. ナビゲーションテスト (NAV)

| 項目 ID | 操作 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| CUST-NAV-001 | ブラウザバック（詳細 → 一覧） | 詳細パネルが開いた状態でブラウザの戻るボタンを押すと、詳細パネルが閉じ URL が `/customers` に戻る |  |  |  |  |
| CUST-NAV-002 | 詳細パネル閉じるボタン | 詳細パネルの「×」ボタンを押すとパネルが閉じ、URL が `/customers` に戻る |  |  |  |  |
| CUST-NAV-003 | ルームリンク | 詳細パネルの「ルーム」アイコンをクリックすると、関連するビジネスチャット (`/businesschat/:id`) へ遷移する |  |  |  | チャンネル存在時のみ |
| CUST-NAV-004 | タスクリンク | 詳細パネルの「タスク」アイコンをクリックすると、タスク管理画面へ遷移しフィルターがかかる |  |  |  |  |
| CUST-NAV-005 | ノートリンク | 詳細パネルの「ノート」アイコンをクリックすると、顧客ノート画面へ遷移する |  |  |  | ノート存在時のみ |

### 6. データ整合性テスト (DATA)

| 項目 ID | 確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| CUST-DATA-001 | 連携アカウント表示 | 「連携アカウント」項目に、紐付いているユーザー名が正しく表示される |  |  |  |  |
| CUST-DATA-002 | 新規アカウント作成リンク | 連携アカウントがない場合、「新規アカウント作成」リンクが表示される |  |  |  |  |

### 7. エラーハンドリングテスト (ERR)

| 項目 ID | 操作 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| CUST-ERR-001 | 存在しない顧客 ID アクセス | `/customers/invalid_id` にアクセスすると、一覧画面にリダイレクトまたは 404 表示 |  |  |  |  |
| CUST-ERR-002 | Biz トークルームなしでの連携 | Biz トークルームがない状態で「新規アカウント作成」をクリックすると、アラートが表示される |  |  |  |  |

---

## テスト環境情報

- **テスト環境 URL**: [https://staging.follot-biz.com](https://staging.follot-biz.com/)
- **テストアカウント**: 別途共有
- **ブラウザ**: Chrome 最新版、Safari 最新版、Edge 最新版
- **デバイス**: PC、タブレット、スマートフォン