# 認証系機能

# 【テスト仕様書】認証系機能

## 基本情報

- **作成日**: 2024年12月
- **対象バージョン**: リリース前最終版
- **テスト対象**: 認証関連機能全般

---

## 1. ログイン機能 (/login)

### 基本情報

- **URL**: `/login`
- **コンポーネント**: `src/components/environments/Login/`
- **主要ファイル**: `LoginForm.tsx`, `index.tsx`

### 機能概要

メールアドレスとパスワードによるFirebase認証を使用したログイン機能

### テスト項目

### 1.1 UI表示テスト

| 項目ID | 確認内容 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T1.1.1 | ページアクセス | Follot-bizロゴ、メールアドレス入力欄、パスワード入力欄、ログインボタン、パスワードリセットリンクが表示される | (25/10/17)井上文 | 〇 |  |
| T1.1.2 | フォームラベル | 「メールアドレス」「パスワード」のラベルが正しく表示される | (25/10/17)井上文 | 〇 |  |
| T1.1.3 | ボタン表示 | 「ログイン」ボタン（黄色）、「メールアドレス/パスワードを忘れた方」ボタン（グレー）が表示される | (25/10/17)井上文 | 〇 |  |

### 1.2 バリデーションテスト

| 項目ID | 入力値 | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| T1.2.1 | 空欄のまま | ログインボタンクリック | バリデーションエラーが表示される | (25/10/17)井上文 | × | バリデは出るが英語表記(email is a required field/password is a required field) |
| T1.2.2 | 無効なメール形式（例: `test@`） | ログインボタンクリック | メールアドレスのフォーマットエラーが表示される | (25/10/17)井上文 | × | バリデは出るが英語表記(email must be a valid email)
日本語のバリデも浮き出て気はした([～は完全なメールアドレスではありません。「@」に続く完全なメールアドレスを入力してください]) |
| T1.2.3 | パスワードのみ空欄 | ログインボタンクリック | パスワード入力エラーが表示される | (25/10/17)井上文 | 〇：上記の通り英語だがPASSにのみバリデは出ている | password is a required field |
| T1.2.4 | メールアドレスのみ空欄 | ログインボタンクリック | メールアドレス入力エラーが表示される | (25/10/17)井上文 | 〇：上記の通り英語だがメールアドレスにのみバリデは出ている | email is a required field

 |
|  |  |  |  |  |  |  |

### 1.3 認証テスト

| 項目ID | 入力値 | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| T1.3.1 | 正しい認証情報 | ログインボタンクリック | テナント選択画面に遷移する | (25/10/17)井上文 | 〇 |  |
| T1.3.2 | 存在しないメールアドレス | ログインボタンクリック | 「メールアドレスまたはパスワードが正しくありません」エラー表示 | (25/10/17)井上文 | × | email must be a valid email |
| T1.3.3 | 間違ったパスワード | ログインボタンクリック | 「メールアドレスまたはパスワードが正しくありません」エラー表示 | (25/10/17)井上文 | × | メールアドレスが正しいと「ユーザーが見つかりません」とだけ出てくる |
| T1.3.4 | メール未認証アカウント | ログインボタンクリック | メール認証を促すメッセージが表示される | (25/10/17)井上文 | ？ | 管理画面側で作ったアカウントでログイン画面を乗り越えようとした時の内容？ |

### 1.4 ナビゲーションテスト

| 項目ID | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T1.4.1 | 「メールアドレス/パスワードを忘れた方」リンククリック | パスワードリセット画面（/password-reset）に遷移 | (25/10/17)井上文 | △ | 遷移はするがページのレイアウトが大分簡素で問題がないか不安 |
| T1.4.2 | ログイン成功後 | テナント選択画面（/tenant-select）に遷移 | (25/10/17)井上文 | 〇 | 上記の画面からログイン画面に戻るボタンが存在しない |

---

## 2. テナント選択機能 (/tenant-select)

### 基本情報

- **URL**: `/tenant-select`
- **前提条件**: ログイン済み状態

### 機能概要

ユーザーが所属するテナント（組織）を選択してアプリケーションにアクセスする機能

### テスト項目

### 2.1 UI表示テスト

| 項目ID | 確認内容 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T2.1.1 | ページ表示 | 所属テナント一覧が表示される | (25/10/17)井上文 | 〇 |  |
| T2.1.2 | テナント情報表示 | 各テナントの名前、ロゴ（あれば）が表示される | (25/10/17)井上文 | △ | 名前はプルダウンで選択できるがロゴは見当たらない |
| T2.1.3 | 選択ボタン表示 | 各テナントに「選択」ボタンが表示される | (25/10/17)井上文 | △ | 組織とテナントのプルダウンがあるだけなのだが、本件とT2.1.2の内容を見るにそれ以外の何か(テナント名をロゴ的に見せている等)がなければいけない？ |

### 2.2 機能テスト

| 項目ID | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T2.2.1 | テナント選択 | 選択したテナントでアプリケーション（/workchat）にアクセスできる | (25/10/17)井上文 | 〇 |  |
| T2.2.2 | 複数テナント所属時 | すべての所属テナントが表示される | (25/10/17)井上文 | 〇 |  |
| T2.2.3 | テナント未所属時 | 適切なメッセージが表示される | (25/10/17)井上文 | ？ | テナントに見所属な状態でここに行く事はあるのか？ |

---

## 3. パスワードリセット機能 (/password-reset)

### 基本情報

- **URL**: `/password-reset`
- **コンポーネント**: `src/components/environments/PasswordReset/`

### 機能概要

メールアドレスを入力してパスワードリセット用メールを送信する機能

### テスト項目

### 3.1 UI表示テスト

| 項目ID | 確認内容 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T3.1.1 | ページ表示 | メールアドレス入力欄、送信ボタン、戻るリンクが表示される | (25/10/18)井上文 | × | [パスワードリセットメールを送信する]ボタンを押しても本能なし＆メールは送られてこない　/　戻るリンクなし

上記で無反応だったアドレスで再度ログイン画面からログインしようとしたところ無事ログインできるので、メール云々以前にそもそも機能してない可能性はある |
| T3.1.2 | 説明文表示 | パスワードリセットの手順説明が表示される | (25/10/18)井上文 | × | メールが来ないので分からない |

### 3.2 バリデーションテスト

| 項目ID | 入力値 | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| T3.2.1 | 空欄 | 送信ボタンクリック | メールアドレス入力エラーが表示される | (25/10/18)井上文 | × | 反応なし |
| T3.2.2 | 無効なメール形式 | 送信ボタンクリック | メールアドレス形式エラーが表示される | (25/10/18)井上文 | × | 浮き出たエラーメッセージで以下確認
・「メールアドレスに「@」を挿入してください。「～(入力した内容)」内に「@」がありません」
・「[~]は完全なメールアドレスではありません。「@」に続く文字列を入力してください」

しかし、[aaaa@aa]のような、上記の内容をクリアした問題のあるメールアドレスだと、バリデーションは発生しない |

### 3.3 機能テスト

| 項目ID | 入力値 | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| T3.3.1 | 登録済みメールアドレス | 送信ボタンクリック | 「パスワードリセットメールを送信しました」メッセージ表示 | (25/10/18)井上文 | × | T3.1.1参照 |
| T3.3.2 | 未登録メールアドレス | 送信ボタンクリック | 「メールアドレスが見つかりません」エラー表示 | (25/10/18)井上文 | × | T3.1.1参照 |
| T3.3.3 | メール送信後 | メール確認 | パスワードリセット用メールが届く | (25/10/18)井上文 | × | T3.1.1参照 |

### 3.4 ナビゲーションテスト

| 項目ID | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T3.4.1 | 戻るリンククリック | ログイン画面（/login）に遷移 | (25/10/18)井上文 | × | T3.1.1参照 |

---

## 4. ログアウト機能 (/logout)

### 基本情報

- **URL**: `/logout`
- **前提条件**: ログイン済み状態

### 機能概要

現在のセッションを終了し、ログイン画面に戻る機能

### テスト項目

### 4.1 機能テスト

| 項目ID | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T4.1.1 | ログアウト実行 | ログイン画面（/login）にリダイレクトされる | (25/10/18)井上文 | 〇 |  |
| T4.1.2 | ログアウト後のアクセス | 認証が必要なページにアクセスするとログイン画面にリダイレクトされる | (25/10/18)井上文 |  | 確認方法不明 |
| T4.1.3 | セッション状態 | ブラウザを閉じて再度開いてもログアウト状態が維持される | (25/10/18)井上文 | △ | FBタブを閉じる→新規のタブでFBのURLを叩く　の挙動として認識

ログインしていればログインした状態で開くし、ログアウトしていればログアウトした状態で開く |

---

## 統合テスト

### 認証フロー全体テスト

| 項目ID | 操作手順 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T5.1 | 1. ログイン→2. テナント選択→3. アプリ利用→4. ログアウト | 各画面で正しく遷移し、最終的にログイン画面に戻る | (25/10/18)井上文 | 〇 |  |
| T5.2 | ブラウザバック操作 | 認証フロー中に適切に制御される | (25/10/18)井上文 | × | ナビゲーションを順(チャット、タスク、AI、顧客管理、Biz)に遷移し、Bizトークの画面まで行った後でブラウザバックしたところ、エラーメッセージページに遷移した
※本番では再現しない

表示されたエラーメッセージ：`FIRESTORE (12.4.0) INTERNAL ASSERTION FAILED: Unexpected state (ID: b815) CONTEXT: {"Pc":"Error: FIRESTORE (12.4.0) INTERNAL ASSERTION FAILED: Unexpected state (ID: ca9) CONTEXT: {\"ve\":-1}\n at _ (https://follot-biz--mock-5p17rynz.web.app/js/vendors-0520917b.113154f65e2134e4b541.bundle.js:2:1595)\n at E (https://follot-biz--mock-5p17rynz.web.app/js/vendors-0520917b.113154f65e2134e4b541.bundle.js:2:1683)\n at As.Ke (https://follot-biz--mock-5p17rynz.web.app/js/vendors-0520917b.113154f65e2134e4b541.bundle.js:2:60213)\n at https://follot-biz--mock-5p17rynz.web.app/js/vendors-0520917b.113154f65e2134e4b541.bundle.js:2:60649\n at Array.forEach (<anonymous>)\n at bs.forEachTarget (https://follot-biz--mock-5p17rynz.web.app/js/vendors-0520917b.113154f65e2134e4b541.bundle.js:2:60940)\n at bs.tt (https://follot-biz--mock-5p17rynz.web.app/js/vendors-0520917b.113154f65e2134e4b541.bundle.js:2:60540)\n at Mi (https://follot-biz--mock-5p17rynz.web.app/js/vendors-0520917b.113154f65e2134e4b541.bundle.js:2:119236)\n at mi.onNext (https://follot-biz--mock-5p17rynz.web.app/js/vendors-0520917b.113154f65e2134e4b541.bundle.js:2:113265)\n at https://follot-biz--mock-5p17rynz.web.app/js/vendors-0520917b.113154f65e2134e4b541.bundle.js:2:110917"}` |
| T5.3 | 直接URL入力 | 未認証時は適切にログイン画面にリダイレクトされる | (25/10/18)井上文 | 〇 | 全くテストで利用していないGoogleアカウントでFBログイン後のURLを直入力→ログイン画面に遷移 |

---

## テスト環境情報

- **テスト環境URL**: [https://staging.follot-biz.com](https://staging.follot-biz.com/)
- **テストアカウント**: 別途共有
- **ブラウザ**: Chrome最新版、Safari最新版、Edge最新版
- **デバイス**: PC、タブレット、スマートフォン