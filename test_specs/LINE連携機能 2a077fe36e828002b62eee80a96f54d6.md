# LINE連携機能

# 【テスト仕様書】LINE連携機能

## 情報

- **作成日**: 2025年10月24日
- **対象バージョン**: リリース前最終版
- **テスト対象**: LINE連携機能全般（認証設定、メッセージ送受信、未承認アカウント管理、ファイル送受信、返信機能、招待メール送信）

---

## 📋 テスト概要サマリー

### テストカテゴリー別構成

### 🔵 統合テスト（セクション 1-4）

**目的**: 複数機能を組み合わせたエンドツーエンドのフロー検証

| セクション | テスト項目 | 対象機能 |
| --- | --- | --- |
| 1 | A. テナント初期セットアップ | LINE連携設定の初期構築 |
| 2 | B. 顧客登録（UI手動入力） | 手動顧客登録 → LINE連携 |
| 3 | C. 顧客登録（外部メール自動） | 自動顧客登録 → LINE連携 |
| 4 | bizTalkルーム作成後の連携 | ルーム作成 → LINE設定 |

**テスト項目数**: 4項目
**想定所要時間**: 約60分

### 🟢 機能テスト（セクション 5-10）

**目的**: 個別機能の詳細な動作検証

| セクション | テスト項目 | 対象機能 | サブセクション | テスト項目数 |
| --- | --- | --- | --- | --- |
| 5 | D. 招待メール送信 | QRコード招待、エラーハンドリング | - | - |
| 6 | E. 内部メンバー連携 | 社内メンバーのLINE連携 | - | - |
| 7 | F. メッセージング基本 | 双方向メッセージング、承認待ち処理 | 3サブセクション | 42項目 |
| 8 | **G. 未承認アカウント管理** | **友だち追加/ブロック、グループ参加/退出、メッセージ受信** | **13サブセクション** | **108項目** |
| ↳ 8.1 | G-1. 友だち追加・ブロック処理 | F-N-1, F-N-2, U-1, F-C-1~6 | 8サブセクション | 61項目 |
| ↳ 8.2 | G-2. グループ参加・退出処理 | J-1, J-2, L-1 | 3サブセクション | 28項目 |
| ↳ 8.3 | G-3. メッセージ受信処理 | M-1, M-2 | 2サブセクション | 19項目 |
| 9 | H. ファイル送受信 | ファイル添付・受信 | 2サブセクション | 10項目 |
| 10 | I. 返信・スレッド | 引用返信、スレッド変換 | 8サブセクション | 43項目 |

**テスト項目数**: 203項目（機能テストのみ）
**想定所要時間**: 約240分（Section 8が大幅に拡充されたため）

### 🔴 エラーテスト（セクション 11）

**目的**: 異常系・エラーハンドリングの検証

- API認証エラー
- LINE連携エラー
- メッセージ送信失敗時のリトライ
- グループ削除時の同期

**テスト項目数**: 4項目
**想定所要時間**: 約30分

### 🟡 回帰テスト（セクション 12）

**目的**: 既存機能への影響確認

- 既存bizトーク機能への影響確認

**テスト項目数**: 1項目
**想定所要時間**: 約30分

### 🟣 統合テスト（エンドツーエンド）（セクション 13）

**目的**: 完全なシナリオベースの総合検証

- 完全なLINE連携フロー
- 名前表示の統合テスト

**テスト項目数**: 2項目
**想定所要時間**: 約45分

### ⚪ バリデーションテスト（セクション 14）

**目的**: 入力値検証の確認

- 入力検証

**テスト項目数**: 1項目
**想定所要時間**: 約15分

---

### 📊 テスト実施推奨順序

1. **Phase 1: 基本セットアップ** → セクション 1（統合テスト）
2. **Phase 2: コア機能検証** → セクション 7（メッセージング基本）
3. **Phase 3: 承認フロー詳細検証** → **セクション 8（未承認アカウント管理）**
    - 優先度P0から実施: 8.1.1 (F-N-1), 8.1.5 (F-C-6), 8.1.8 (F-N-2)
    - 依存関係に注意: U-1 → F-C-2, J-1 → F-C-3/M-2
4. **Phase 4: 拡張機能検証** → セクション 9, 10（ファイル送受信、スレッド）
5. **Phase 5: 統合フロー検証** → セクション 2, 3, 4, 13（統合テスト）
6. **Phase 6: エラー・回帰検証** → セクション 11, 12, 14（エラー・回帰・バリデーション）

**⚠️ Section 8の実施上の注意**:

- テスト環境の準備が複雑（複数LINEアカウント、グループ作成など）
- 一部のシナリオは手動再現困難（J-2など）→ 自然発生時のログ確認推奨
- F-C-6はUI操作困難な場合あり → エンジニアに環境準備を依頼

---

### 📈 テスト完了基準

- ✅ 全290項目のテストステップが実行済み
    - 統合テスト: 4項目
    - 機能テスト: 203項目（うちSection 8: 108項目）
    - エラーテスト: 4項目
    - 回帰テスト: 1項目
    - エンドツーエンド: 2項目
    - バリデーション: 1項目
- ✅ クリティカルバグ（P0/P1）が0件
- ✅ 既存機能への影響が無いことを確認
- ✅ エラーハンドリングが正常に動作することを確認
- ✅ Section 8の全シナリオ（F-N-1~2, U-1, F-C-1~6, J-1~2, L-1, M-1~2）が検証済み

---

## テスト実施前の事前準備

### 必要なLINEアカウント

テストを実施するには、以下を事前に用意してください：

### 1. LINE公式アカウント（LOAM設定済み）

- **用途**: テナント全体のLINE連携用
- **設定場所**: LINE Official Account Manager (LOAM) + LINE Developersコンソール
- **備考**:
    - 開発者/管理者が事前にMessaging APIを有効化済み
    - チャネルアクセストークンとチャネルシークレットをFirebaseに設定済み
    - Webhook URLを設定済み
    - **テスターは設定不要**（すでに設定済みの環境でテスト実施）

### 2. テスト用LINEアカウント（2端末、2アカウント）

- **用途**: 顧客役・社内メンバー役のテスト
- **必要なもの**:
    - **端末1**: LINEアカウント1（スマートフォンまたはタブレット）
    - **端末2**: LINEアカウント2（別のスマートフォンまたはタブレット）
    - ※1端末1LINEアカウントのため、2端末必要
- **実施内容**:
    - **アカウント1（端末1）**: 以下のすべてのテストに使用
        - 友だち追加テスト（招待メール/QRコード経由 ※機能的に同一）
        - ブロック/ブロック解除テスト（解除後、再度友だち追加と同様の動作確認が可能）
        - グループトーク作成・基本動作テスト
    - **アカウント2（端末2）**: グループトークの複数ユーザーシナリオテスト用
        - アカウント1が作成したグループに追加される側としてテスト
- **備考**:
    - 招待メールとQRコードは機能的に同一のため、両方を別アカウントでテストする必要はない
    - ブロック/ブロック解除により、1アカウントで友だち追加動作を複数回テスト可能

---

## 対象URL/画面と具体的なアクセス方法

### テナントのLINE連携設定

- **URL**: `/settings/tenants`
- **遷移方法**:
    1. 「テナント設定」から「テナント情報」を開く
    2. 対象テナントの「編集」ボタンをクリック
    3. 「連携設定」タブを選択
    4. 「外部メッセージサービス連携設定」セクションを確認
    5. LINE欄の「設定開始」または「設定変更」ボタンをクリック

### LINE管理画面（連携承認待ちの承認など）

- **URL**: `/external-services-management/line`
- **遷移方法**（以下いずれかの方法）:
    - **方法1**: 上記のテナント連携設定画面で、LINE欄の「詳細管理」ボタンをクリック
    - **方法2**: bizトークルーム画面で、承認待ち連絡先がある場合、画面右上に表示される通知メッセージをクリック
    - **方法3**: bizトークルーム画面のサブカラム（右側パネル）の「概要」セクションに表示される警告バナーをクリック

### bizTalkルームのLINE連携設定

- **URL**: `/businesschat`（各ルーム）
- **遷移方法**:
    1. bizトーク画面で「!」を押す
    2. 画面右側のサブカラム（SubCol）で「概要」セクションを確認
    3. 「連携設定」欄を探す
    4. 「設定」ボタンをクリック
    5. 「連携サービス」の「LINE」を選択

---

## 1. A. テナント初期セットアップ（統合テスト）

### 1.1 A-1: LINEアカウント連携（Channel Access Token方式）

### 基本情報

- **前提条件**: テナント管理者（admin/owner）でログイン済み
- **URL**: `/settings/tenants`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-INT-001 | `/settings/tenants` にアクセス | テナント設定画面が表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-002 | 対象テナントの「編集」ボタンをクリック | テナント編集モーダルが開く | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-003 | 「連携設定」タブを選択 | 「外部メッセージサービス連携設定」セクションが表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-004 | 【UI確認】未連携状態の表示 | LINE欄に「設定開始」ボタンが表示される | 井上文 | 2025/11/05 | 〇 | △：[設定開始]
〇：[初回設定を開始] |
| LINE-INT-005 | 「設定開始」ボタンをクリック | モーダル「LINE 連携設定」が開く | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-006 | 【UI確認】モーダル内「LINE側で設定が必要な情報」セクション表示 | 折りたたみ可能なセクションが表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-007 | 「LINE側で設定が必要な情報」を展開 | 「Webhook URL」が表示され、「コピー」ボタンがある | 井上文 | 2025/11/05 | 〇 | コピーボタンを押したら「コピーしました」みたいなメッセージが出ても良いのではないか |
| LINE-INT-008 | URLコピーボタンをクリック | クリップボードにURLがコピーされる | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-009 | 【外部操作】LINE Developersコンソールで公式アカウント作成 | Messaging APIを有効化し、チャネルアクセストークン、チャネルシークレット、チャネルIDを取得 |  |  |  | LINE側の操作 |
| LINE-INT-010 | 【外部操作】LINE DevelopersコンソールでWebhook URL設定 | follot-bizで生成されたWebhook URLをLINE側に設定 |  |  |  | LINE側の操作 |
| LINE-INT-011 | 【UI確認】入力フィールド表示 | 「チャネルアクセストークン」「チャネルシークレット」「チャネルID」入力フィールドが表示される |  |  |  |  |
| LINE-INT-012 | LINEから取得したチャネルアクセストークン、チャネルシークレット、チャネルIDを入力 | 各フィールドに正しく入力される |  |  |  |  |
| LINE-INT-013 | 「接続をテスト」ボタンをクリック | 接続テストが実行され、成功メッセージが表示される |  |  |  |  |
| LINE-INT-014 | 「保存」ボタンをクリック | 設定が保存され、モーダルが閉じる |  |  |  |  |
| LINE-INT-015 | 【UI確認】連携済み状態の表示 | LINE欄に連携済みアカウント名（ベーシックID）、「設定変更」「詳細管理」ボタンが表示される |  |  |  |  |
| LINE-INT-016 | 設定画面を再読み込み | 連携状態が維持され、連携済み情報が表示される |  |  |  |  |

---

## 2. B. 顧客登録（UI手動入力パターン）（統合テスト）

### 2.1 B-1: 新規顧客の手動登録とLINEルーム連携

### 基本情報

- **前提条件**: テナント初期セットアップ完了（1.1）
- **フロー参照**: LINE-INT-051以降は4.1（LINE-INT-033〜050）のbizTalkルームセットアップフローを実施

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-INT-050 | 顧客管理画面で新規顧客を手動入力（メールアドレス含む） | 顧客情報が正常に保存される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-051 | **以降、5.1のフロー（LINE-INT-033〜050）を実施**: bizTalkルーム作成 → LINE連携設定 → 顧客リストにLINE招待ボタン表示確認 | 5.1のテスト項目がすべて成功する | 井上文 | 2025/11/05 | 〇 | セクション5.1参照

一応成功している |
| LINE-INT-052 | 情報パネル > 顧客リスト > 対象顧客の「LINE招待」ボタンをクリック | 「LINE招待 - [顧客名]」モーダルが開く | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-053 | 【UI確認】モーダル内の表示 | メールアドレス、追加メッセージ入力欄、「QRコード付き招待メールを送信」ボタンが表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-054 | 招待メッセージを入力し「QRコード付き招待メールを送信」ボタンをクリック | 招待メールが顧客に送信される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-055 | 【確認】顧客のメール受信 | QRコード画像、LINE公式アカウントのベーシックID、招待メッセージが含まれたメールが届く | 井上文 | 2025/11/05 | 〇 | メール本文確認

[【BUG?】LINE連携：Bizトークルーム内の[顧客＞招待]でLINE招待メールを送る際、メールにはQRコードが乗る筈だが載っていない可能性がある](https://www.notion.so/BUG-LINE-Biz-LINE-QR-2a277fe36e8280f187e6d54e903e6496?pvs=21)
→解消 |
| LINE-INT-056 | 顧客がQRコードをスキャンまたはベーシックIDで検索して友だち追加 | LINE公式アカウントと友だちになる | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-057 | 友だち追加時の通知確認（bizトークルームを開いている場合） | Toast通知、警告バナー、FCM通知（ブラウザ通知）のいずれかまたは全てが表示される | 井上文 | 2025/11/06 | × | [【BUG】LINE連携：未連携のユーザーからLINEを通じてFB公式にメッセージが送られてきた際、FB側で顧客との紐づけを示唆、誘導する通知(Toast通知？)が現れない？](https://www.notion.so/BUG-LINE-LINE-FB-FB-Toast-2a377fe36e82801a9c12df794ad4246e?pvs=21)

[【BUG？】LINE連携：FB上で顧客の紐付けを行う前に、顧客側のLINEからメッセージが複数回送られていた場合、FB上で顧客紐付けを行った際にそれらの送られてきていたメッセージがBizトークのルームチャットに反映されない](https://www.notion.so/BUG-LINE-FB-LINE-FB-Biz-2a377fe36e82801f8905f85033112004?pvs=21)
→解消済 |
| LINE-INT-058 | 通知または警告バナーをクリック | LINE管理画面（/external-services-management/line）に遷移する | 井上文 | 2025/11/06 | 〇 | デスクトップ通知は来ているのでそれをクリックしたら遷移はした |
| LINE-INT-059 | LINE管理画面で「連携承認待ち」タブを確認 | 未承認のLINEアカウントが表示される | 井上文 | 2025/11/07 | 〇 | この時点では承認せずに次へ |
| LINE-INT-060 | bizトーク画面に戻る | 情報パネルの概要タブに「⚠️ 未紐付けLINEアカウント」警告バナーが表示される | 井上文 | 2025/11/07 | 〇 |  |
| LINE-INT-061 | 顧客がLINEから初回メッセージを送信 | bizトーク画面にメッセージが表示される | 井上文 | 2025/11/07 | 〇 |  |
| LINE-INT-062 | 管理者権限（admin/owner/manager）でメッセージ内容を確認 | LINEから送信されたメッセージの内容が表示される | 井上文 | 2025/11/07 | 〇 | 権限による表示制御

C-1のテストで確認 |
| LINE-INT-063 | 一般ユーザー権限（user/guest/customer）でメッセージ確認 | 「(送信を準備しています)」と表示され、メッセージ内容は見えない | 井上文 | 2025/11/07 | 〇 | 権限による表示制御

[【BUG？】LINE連携：アカウントの権限がどれであっても、LINEから送られてきたメッセージが確認できてしまう](https://www.notion.so/BUG-LINE-LINE-2a477fe36e82809da405f58d77b068ef?pvs=21)
→解決 |
| LINE-INT-064 | 警告バナーをクリック → LINE管理画面に遷移 | 「連携承認待ち」タブに未承認のLINEアカウントが表示される | 井上文 | 2025/11/07 | × | [【BUG】LINE連携：未連携のユーザーからLINEを通じてFB公式にメッセージが送られてきた際、FB側で顧客との紐づけを示唆、誘導する通知(Toast通知？)が現れない？](https://www.notion.so/BUG-LINE-LINE-FB-FB-Toast-2a377fe36e82801a9c12df794ad4246e?pvs=21) |
| LINE-INT-065 | 対象アカウントの「承認」ボタンをクリック | 承認確認ダイアログが表示され、承認完了 | 井上文 | 2025/11/07 | 〇 |  |
| LINE-INT-066 | bizトーク画面に戻り、過去のメッセージ表示を確認 | 過去の全メッセージが時系列順に表示される | 井上文 | 2025/11/07 | × |  |
| LINE-INT-067 | 双方向でメッセージを送受信 | メッセージが正常に送受信できる | 井上文 | 2025/11/07 | 〇 | 送信したメッセージ：こんにちは　Bizトークより

受信したメッセージ：【Sys_Bun】こんにちは　Bizトークより |
| LINE-INT-068 | 【UI確認】顧客リストで承認済み顧客のボタン表示 | 「連携済み」ボタンが無効化される | 井上文 | 2025/11/07 | 〇？ | サブカラム内の顧客＞(アコーディオン展開)で出てくる顧客の右にうっすらついてる「連携済み」のマークは存在する＆押下してもなんにも反応しない |

---

## 3. C. 顧客登録（外部メール自動登録パターン）（統合テスト）

### 3.1 C-1: 外部メールからの自動登録とLINEルーム連携

### 基本情報

- **前提条件**: テナント初期セットアップ完了、外部メール連携設定済み

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-INT-067 | 外部メールアドレスからメール受信 | 1. 顧客情報が自動的に作成される<br>2. bizTalkルームが自動的に作成・紐付けされる | 井上文 | 2025/11/07 | 〇 | 新規顧客作成時はルームも自動作成される |
| LINE-INT-068 | ルームリストを確認 | 自動作成された顧客のルームが表示される | 井上文 | 2025/11/07 | 〇 |  |
| LINE-INT-069 | LINE招待メール送信とQRコード生成 | B-1と同様の手順で招待メールが送信される | 井上文 | 2025/11/07 | 〇 |  |
| LINE-INT-070 | 顧客のLINE友だち追加とメッセージ送信 | B-1と同様に未承認アカウントとして登録される | 井上文 | 2025/11/07 | 〇 |  |
| LINE-INT-071 | 承認フローの確認 | B-1と同様に承認フローが正常に動作する | 井上文 | 2025/11/07 | 〇 |  |

---

## 4. bizTalkルーム作成後のLINEルームセットアップ（統合テスト）

### 4.1: 顧客を含むbizTalkルーム作成とLINE連携設定

### 基本情報

- **前提条件**:
    - テナントのLINEアカウント連携済み（1.1）
    - 顧客登録済み（2. B または 3. C）
- **URL**: `/businesschat`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-INT-033 | bizTalkで新規ルームを作成（登録済み顧客を追加） | ルームが正常に作成される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-034 | 作成したルームをクリックして開く | ルームのメインビューが表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-035 | 【UI確認】bizトーク画面の基本表示 | サイドバーに顧客名ごとのルームリストが表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-036 | 画面右肩の「！」アイコンをクリック | 情報パネル（SubCol）が開く | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-037 | 【UI確認】情報パネルのタブ表示 | パネル上部に「表示概要」「顧客」「ノート」のタブが表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-038 | 【UI確認】アコーディオンメニュー表示 | 「顧客リスト」「ルーム情報」「メンバーリスト」のアコーディオンが表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-039 | 「ルーム情報」アコーディオンを展開 | 外部サービス連携設定の項目が表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-040 | 【UI確認】外部サービス連携設定の初期表示 | 未設定アイコンと「未設定」の表示、「設定」ボタンが表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-041 | 「設定」ボタンをクリック | 「外部サービス連携設定」モーダルが開く | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-042 | 【UI確認】モーダル内の連携サービス選択 | 「連携サービス」ドロップダウンに「LINE」が選択肢として表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-043 | ドロップダウンで「LINE」を選択 | 「LINE ルームID（任意）」フィールドが表示される | 井上文 | 2025/11/05 | 〇 | プレースホルダー: "C1234567890abcdefghij1234567890 or U1234567890abcdefghij1234567890" |
| LINE-INT-044 | 【UI確認】LINE ルームIDフィールド | 任意項目として表示される（入力不要） | 井上文 | 2025/11/05 | 〇 | 説明テキスト: "LINEグループのIDを入力してください（任意）" |
| LINE-INT-045 | LINE ルームIDを空欄のまま保存 | 問題なく保存できる | 井上文 | 2025/11/05 | 〇 | 通常の使用では入力不要 |
| LINE-INT-046 | 「設定を保存」ボタンをクリック | 設定が保存され、モーダルが閉じる | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-047 | 【UI確認】連携設定後の表示 | 外部サービス連携設定にLINEアイコンと「LINE」が表示される | 井上文 | 2025/11/05 | 〇 | 実際には「LINE管理」画面で連携承認後に表示される |
| LINE-INT-048 | 【UI確認】サイドバーのLINEアイコン表示 | ルーム名の左側（横）にLINEアイコンが表示される | 井上文 | 2025/11/05 | 〇 | LINE連携済みルームの場合、サービスアイコンとしてルーム名の左隣に表示 |
| LINE-INT-049 | 情報パネルの「顧客リスト」アコーディオンを展開 | 顧客リストが表示される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-INT-050 | 【UI確認】LINE招待ボタン表示（連携済みルーム） | 各顧客の横に「LINE招待」ボタンが表示される | 井上文 | 2025/11/05 | 〇 |  |

---

## 5. D. 招待メール送信機能（機能テスト）

### 5.1 D-1: QRコード付き招待メール送信

### 基本情報

- **機能**: QRコード生成、Basic ID自動取得、メール送信

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FUNC-001 | LINE招待モーダルで招待メッセージを入力 | テキストが正しく入力される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-FUNC-002 | 「QRコード付き招待メールを送信」ボタンをクリック | メール送信処理が開始される | 井上文 | 2025/11/05 | 〇 |  |
| LINE-FUNC-003 | 【バックエンド確認】LINE Bot Info API呼び出し | Basic IDが自動的に取得される | 井上文 | 2025/11/05 | 確認方法不明 | `GET <https://api.line.me/v2/bot/info`> |
| LINE-FUNC-004 | 【バックエンド確認】QRコード生成 | Basic IDを含むLINE公式アカウント追加URLからQRコード画像が生成される | 井上文 | 2025/11/05 | 確認方法不明 | `https://line.me/R/ti/p/@{basicId}` |
| LINE-FUNC-005 | 顧客のメール受信確認 | QRコード画像が添付されたメールが届く | 井上文 | 2025/11/05 | 〇 | メール上での画像表示がうまく出てこない

メール側で「画像を表示する」を使用しても表示されない

YahooメールにはQRコードが返ってきたのでGメールだけ(自分の環境だけ？)かも

→解消済 |
| LINE-FUNC-006 | メール本文にBasic ID表示確認 | メール本文にBasic ID（`@xxxxxxxx`形式）が表示される | 井上文 | 2025/11/05 | 〇 | 手動検索用

[※ボタンがクリックできない場合は、以下のURLをブラウザに貼り付けてアクセスしてください。[https://line.me/R/ti/p/@277oxehm](http://url8759.follot.biz/ls/click?upn=u001.CpoVGC8ua4QCD-2B0KcG5h-2BW-2BPkcwqHeoRC-2FyuL3DdXy7hHCXUGkwIwunEpY3bnDKh1zVd_8fVbVU90MMJJCSq-2FarS40DjydhlQVVc2kd95P8kcFTZ9N3ObFuIew0m8pXPFTgCh6P2nA-2Bi7xk70S2hoa0bko4-2Bf31UmtMSNcqiaNFDIObkp0P-2BlJysw5wOpdB4plzh1CocdsKwTsa-2B6Rg3KByuyEKe3XeLFGa-2F1CPzYZoSy8ViemKfBCc8b1Qo95f8ST-2Fj3mCEi9tPuDCBHiymm-2FsAxDw-3D-3D)]←Basic ID |
| LINE-FUNC-007 | メール本文に招待メッセージ表示確認 | 入力した招待メッセージがメール本文に含まれる | 井上文 | 2025/11/05 | 〇 |  |
| LINE-FUNC-008 | QRコードスキャン | スマートフォンでQRコードをスキャンすると、LINE公式アカウント追加画面が開く | 井上文 | 2025/11/05 | 〇 |  |
| LINE-FUNC-009 | Basic ID手動検索 | LINEアプリでBasic IDを検索すると、LINE公式アカウントが表示される | 井上文 | 2025/11/05 | 〇 | [LINE-FUNC-010]の後に検索してみたが、[FBボット-staging(友達に登録済です)]が表示された |
| LINE-FUNC-010 | 友だち追加 | 「追加」ボタンをタップすると友だち追加される | 井上文 | 2025/11/05 | 〇 |  |

### 5.2 D-2: 招待メールエラーハンドリング

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FUNC-011 | メールアドレスが未設定の顧客に招待メール送信を試行 | エラーメッセージ「顧客にメールアドレスが設定されていません」が表示される | 井上文 | 2025/11/08 | 〇 |  |
| LINE-FUNC-012
★ | 既に友だち追加済みの顧客に招待メール送信を試行 | 送信は成功するが、「既に友だち登録済みです」等の注意メッセージが表示される（オプション） | 井上文 | 2025/11/08 | テスト方法不明 | 2025/11/17　改めてみてもテスト方法が分かりません |

---

## 6. E. 内部メンバーの連携（機能テスト）

### 6.1 E-1: 社内メンバーのLINE連携（技術的制約の確認）

### 基本情報

- **重要**: LINE Messaging APIには個人アカウントAPI（OAuth認証）が存在しないため、社内メンバーの個人認証は**実装不可**
- **代替方式**: Bot名義でのメッセージ送信のみ可能
- **表示名プレフィックス**: 【follot-bizの表示名】が常にメッセージ先頭に付与される

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FUNC-013 | bizTalkからメッセージを送信（社内メンバー） | メッセージが正常に送信される | 井上文 | 2025/11/16 | 〇 | 難しく考えていましたが、ここに関しては単純に「FBボット公式からLINE顧客にメッセージが投下されるか」という認識で良いのだと考えて判断をすることにしました |
| LINE-FUNC-014 | LINE側での送信者名確認 | LINE側でBot名義で送信され、メッセージ先頭に「【follot-bizユーザーの表示名】」が付与される | 井上文 | 2025/11/08 | 〇 | 例: 「【田中太郎】こんにちは」 |
| LINE-FUNC-015 | 複数ユーザーでの動作確認 | 各ユーザーのメッセージに、それぞれのfollot-biz表示名がプレフィックスとして付与される | 井上文 | 2025/11/08 | 〇 | 送信者識別のため

３アカウント(権限別)分で確認 |

### 6.2 E-2: LINEグループ内の社内メンバー管理

### 基本情報

- **機能**: LINEグループトークで社内メンバーが発言した場合、その発言もbizトークに転送
- **データ構造**: `tenants/{tenantId}/lineInternalUsers/{lineUserId}` で社内メンバーを管理

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FUNC-016 | 【前提】LINEグループに社内メンバー（follot-bizユーザー）を追加 | グループメンバーとして追加される | 井上文 | 2025/11/15 | 〇 | 【行った操作】LINE側トーク画面、右上[三]押下
→[招待]押下→FBボット+別のLINEアカウントを入れてグループ作成 |
| LINE-FUNC-017 | LINE管理画面で社内メンバー登録 | LINE User IDとfollot-biz User IDを紐付けて登録 | 井上文 | 2025/11/15 | 〇 | `/external-services-management/line?tab=internal-users`  |
| LINE-FUNC-018 | 登録した社内メンバーがLINEグループで発言 | メッセージがfollot-bizに転送される | 井上文 | 2025/11/15 | × | [【BUG】LINE連携：FBユーザーと紐づけたLINEアカウントでグループトークにメッセージを送った場合、FB画面で再度[外部サービス連携>LINE管理ページ]で紐付けの作業を要求される](https://www.notion.so/BUG-LINE-FB-LINE-FB-LINE-2ac77fe36e8280e985a3c39cd56055a4?pvs=21) |
| LINE-FUNC-019 | bizトーク側での発言者名確認 | follot-bizの表示名（LINE名ではなく）で表示される | 井上文 | 2025/11/15 | 〇 |  |
| LINE-FUNC-020
★ | 未登録の社内メンバーがLINEグループで発言 | 未承認アカウントとして扱われ、承認が必要になる | 井上文 | 2025/11/15 | ？？？ | >未登録の社内メンバー

これの作り方が分かりません |

---

## 7. F. メッセージング基本機能（機能テスト）

### 7.1 F-1: follot-biz → LINE メッセージ送信

### 基本情報

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FUNC-021 | bizTalkでテキストメッセージを入力して送信 | メッセージが正常に送信される | 井上文 | 2025/11/08 | 〇 |  |
| LINE-FUNC-022 | LINE側でメッセージ確認 | メッセージが表示される | 井上文 | 2025/11/08 | 〇 |  |
| LINE-FUNC-023 | LINE側での送信者名確認 | Bot名義で送信され、メッセージ先頭に「【follot-bizユーザーの表示名】」が付与される | 井上文 | 2025/11/08 | 〇 | 例: 「【田中太郎】お世話になっております」 |
| LINE-FUNC-024 | 長文メッセージの送信 | 長文メッセージが正常に送信・表示される | 井上文 | 2025/11/08 | 〇 | LINEの文字数制限: 5000文字

5000文字以上でメッセージが受信されない
4999文字以上であれば受信される |
| LINE-FUNC-025 | 改行を含むメッセージの送信 | 改行が正しく反映される | 井上文 | 2025/11/08 | 〇 |  |

### 7.2 F-2: LINE → follot-biz メッセージ受信

### 基本情報

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FUNC-026 | LINEでテキストメッセージを送信 | LINE側でメッセージが送信される | 井上文 | 2025/11/08 | 〇 |  |
| LINE-FUNC-027 | bizTalk側でメッセージ確認 | メッセージが表示される | 井上文 | 2025/11/08 | 〇 |  |
| LINE-FUNC-028 | bizTalk側での送信者名確認 | 【登録済みユーザー】follot-biz上の名前、【未登録ユーザー】LINE上の表示名が表示される | 井上文 | 2025/11/08 | × | LINEから送ったメッセージは紐づいた顧客の発言としてチャット欄に載るだけで、
FBから送ったメッセージのように頭にアカウント名などが付与されてチャット欄に載ってはいない |
| LINE-FUNC-029 | リアルタイム受信の確認 | メッセージが即座にbizTalkに表示される | 井上文 | 2025/11/08 | 〇 |  |

### 7.3 F-3: 連携承認待ちアカウントの承認とメッセージ表示

### 基本情報

- **テストURL**: `/external-services-management/line?tab=contacts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FUNC-030 | 【前提】未連携LINEアカウントから複数のメッセージを送信 | LINEからメッセージが送信される | 井上文 | 2025/11/08 | 〇 | 昨日(11/07)の鍋谷さんとのテストで確認 |
| LINE-FUNC-031 | 管理者権限でログインし、`/external-services-management/line?tab=contacts` にアクセス | 連携承認待ちリストに該当PendingContactが表示される | 井上文 | 2025/11/08 | 〇 | isAdmin権限が必要 |
| LINE-FUNC-032 | 管理者でLINE管理画面を確認 | 承認待ちリストとメッセージプレビューが表示される | 井上文 | 2025/11/08 | 〇 | pendingContactPermissionUseCaseで制御 |
| LINE-FUNC-033 | 一般ユーザー（非管理者）でログインし、LINE管理画面にアクセスを試みる | 承認待ちリストは空、またはアクセス制限される | 井上文 | 2025/11/08 | × | canViewPendingContacts: false

 |
| LINE-FUNC-034 | 管理者が連携承認待ちリストから「承認」ボタンをクリック | 承認確認ダイアログが表示される | 井上文 | 2025/11/08 | 〇 |  |
| LINE-FUNC-035 | 承認を実行 | 1. 承認成功メッセージが表示される<br>2. 該当アカウントがリストから消える | 井上文 | 2025/11/08 |  | 一人(LINEアカウント１つ)だと確認が難しい |
| LINE-FUNC-036 | bizトーク画面で該当ルームを確認 | 過去のメッセージが時系列順に表示される | 井上文 | 2025/11/08 | × | [【BUG？】LINE連携：FB上で顧客の紐付けを行う前に、顧客側のLINEからメッセージが複数回送られていた場合、FB上で顧客紐付けを行った際にそれらの送られてきていたメッセージがBizトークのルームチャットに反映されない](https://www.notion.so/BUG-LINE-FB-LINE-FB-Biz-2a377fe36e82801f8905f85033112004?pvs=21) |
| LINE-FUNC-037 | 一般ユーザーでbizトーク画面を確認 | 承認後のメッセージがすべて表示される | 井上文 | 2025/11/08 | × | 同上 |
| LINE-FUNC-038 | 承認後の双方向メッセージング | 通常通りメッセージが送受信できる | 井上文 | 2025/11/08 | 〇 |  |

---

## 8. G. 未承認アカウント管理・承認フロー（機能テスト）

### 8.1 G-1: 友だち追加・ブロック処理

### 8.1.1 F-N-1: 候補顧客あり（招待履歴がある場合）

**優先度**: P0

**テスト特性**: 手動承認フローを確認する重要なシナリオです。既存のstaging環境（顧客データがある状態）で実施可能です。

**事前条件**:

- follot-bizに顧客B（佐藤花子さん, メール: `hanako@example.com`）が登録されている
- 佐藤花子さんには過去にLINE招待メールを送信済み（7日以内）

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-G1-001 | LINEアプリで、新しいアカウント（follot-bizに未登録、佐藤花子さんのLINEアカウント）でログイン | ログイン成功 | 井上文 | 2025/11/16 | 〇 | 優先度: P0

そもそもLINE連携したルームからでなければ招待メールが送れない
→>follot-bizに未登録、佐藤花子さんのLINEアカウント　というのをどう再現すればいいか不明
事前準備の内容と、(follot-bizに未登録～)の内容が相反しているのではないか

…と思ったが、ひとまずFBの新規顧客作成で佐藤花子さん,/メール:(`hanako@example.com`)を作成し、LINE連携していたルームに顧客追加＞LINE招待　という手順をとった |
| LINE-G1-002 | follot-bizのLINE公式アカウントを友だち追加 | 友だち追加完了 | 井上文 | 2025/11/16 | 〇 |  |
| LINE-G1-003 | follot-biz「LINE管理画面」を開く | 「承認待ち」リストに新規登録者が表示される | 井上文 | 2025/11/16 | 〇 |  |
| LINE-G1-004 | 承認待ち項目を確認 | 推奨候補として「佐藤花子」が⭐マーク付きで表示される（招待履歴があるため） | 井上文 | 2025/11/16 | 〇 |  |
| LINE-G1-005 | 推奨候補「佐藤花子」を選択して承認 | 1. 承認成功メッセージが表示される<br>2. 「承認待ち」リストから該当項目が消える | 井上文 | 2025/11/16 | 〇 |  |
| LINE-G1-006 | ルームリストを確認 | 「佐藤花子」のルームが表示される | 井上文 | 2025/11/16 | △ | ここは[LINE-G1-001]でどのようにFB内顧客の[佐藤花子]にLINE招待を行ったかで差が出てくる内容ではないだろうか

現状、適当に入れていたLINE連携していたルームのサイドバーの名については、[佐藤花子]となっている
が、ルームメインチャットの上部にある情報は切り替わっていない(上書きされてない) |
| LINE-G1-007 | 顧客詳細を確認 | LINEが連携済みになっている | 井上文 | 2025/11/16 | 〇 |  |
| LINE-G1-008 | ルームでメッセージを送受信 | 正常にメッセージが送受信できる | 井上文 | 2025/11/16 | 〇 |  |

**別パターン**: 新規顧客として登録

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-G1-009 | LINE-G1-002の後、承認待ち項目で「新規顧客として登録」を選択 | 完全に新しい顧客として登録される | 井上文 | 2025/11/16 | 〇 | F-N-2と同じ動作 |

### 8.1.2 U-1: 1on1連携中にブロック（unfollow）

**優先度**: P1

**用語説明**:

- **1on1連携**: LINEの友だち追加（follow）による個人チャット形式の連携
- **グループ連携**: LINEグループにボットを招待（join）する形式の連携
- このテストは1on1連携（友だち追加）でのブロック動作を確認します

**事前条件**:

- **F-N-1（候補顧客ありテスト）が完了していること**
- follot-bizに顧客A（山田太郎さん）が登録されている
- 顧客AのLINEアカウントが既にfollot-bizと連携済み
- follot-biz画面でルームリストに「山田太郎」のルームが表示されている

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-U1-001 | LINEアプリで、顧客A（山田太郎さん）のアカウントでログイン | ログイン成功 | 井上文 | 2025/11/09 | △ | 優先度: P1

とりあえずLINEと繋がっているアカウントがあるという認識 |
| LINE-U1-002 | follot-bizのLINE公式アカウントをブロックする | ブロック完了 | 井上文 | 2025/11/09 | 〇 |  |
| LINE-U1-003 | 管理者に通知が届くか確認 | 「山田太郎さんがLINEでブロックしました」という通知が届く | 井上文 | 2025/11/09 | 〇 | 以下が通知に来ました

**タイトル：**LINE ブロック/削除
**内容：**中岡さんがブロックまたは友だち削除しました
**カテゴリー：**通知
**アクションタイプ：**LINE_UNFOLLOW |
| LINE-U1-004 | Sidebar（ルームリスト）で「山田太郎」のルームを確認 | 1. LINEアイコンが半透明になる

2. ⚠️警告バッジが表示される

3. サービスID（LINE表示名）の箇所が「未連携」と表示される | 井上文 | 2025/11/09 | △ | １：〇

２：✕(⚠️　ではなく　赤い円の中に白い×マーク　他の未連携ルームと同じ)

３：〇 |
| LINE-U1-005 | ルームを開く | 「⚠️ LINE連携済みの顧客がいません」というオレンジ色の警告が表示される | 井上文 | 2025/11/09 | 〇 | システム内部では、ルームとLINE連絡先が「非アクティブ」状態に更新される |

**備考**: このテストケースは、次の「F-C-2: 再友だち追加」テストの事前準備としても機能します。

### 8.1.3 F-C-2: 既に同じ1on1で連携済み（非アクティブ状態→再友だち追加）

**優先度**: P1

**事前条件**:

- **U-1（ブロックテスト）が完了していること**
- follot-bizに顧客A（山田太郎さん）が登録されている
- 顧客Aがbotをブロックしたため非アクティブ状態
- Sidebar（ルームリスト）で「山田太郎」のルームに⚠️マークと「未連携」が表示されている

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FC2-001 | LINEアプリで、顧客A（山田太郎さん）のアカウントでログイン | ログイン成功 | 井上文 | 2025/11/09 | 〇 | 優先度: P1 |
| LINE-FC2-002 | follot-bizのLINE公式アカウントのブロックを解除 | ブロック解除完了 | 井上文 | 2025/11/09 | 〇 |  |
| LINE-FC2-003 | 管理者に通知が届くか確認 | 「山田太郎さんが再びLINEで繋がりました」という通知が届く | 井上文 | 2025/11/09 | × | [【BUG】顧客からLINE公式アカウントをブロック→解除された後のFB側の動き：ブロックが解除された旨の通知が届かない](https://www.notion.so/BUG-LINE-FB-2a577fe36e8280d99085cd08ad2564d8?pvs=21) |
| LINE-FC2-004 | Sidebar（ルームリスト）で「山田太郎」のルームを確認 | 1. LINEアイコンが通常の濃さになる

2. ⚠️警告バッジが消える

3. サービスID（LINE表示名）が正しく表示される（「未連携」ではなくなる） | 井上文 | 2025/11/09 | × | [【BUG】顧客からLINE公式アカウントをブロック→解除された後のFB側の動き：サイドバーのルームの表示が復帰しない](https://www.notion.so/BUG-LINE-FB-2a577fe36e82800abadcf60c752e9fea?pvs=21) |
| LINE-FC2-005 | ルームを開く | 「⚠️ LINE連携済みの顧客がいません」という警告が消えている | 井上文 | 2025/11/09 | × | [【BUG？】顧客からLINE公式アカウントをブロック→解除された後のFB側の動き：「](https://www.notion.so/BUG-LINE-FB-LINE--2a577fe36e8280a48ca1d815d043c87b?pvs=21)⚠ [LINE連携済みの顧客がいません」が表示されたまま、この動きに起因してサブカラム内に「](https://www.notion.so/BUG-LINE-FB-LINE--2a577fe36e8280a48ca1d815d043c87b?pvs=21)⚠ [未紐付け通知　未紐付けLINEアカウントが1件あります」という警告が現れる](https://www.notion.so/BUG-LINE-FB-LINE--2a577fe36e8280a48ca1d815d043c87b?pvs=21) |
| LINE-FC2-006 | LINE管理画面を開く | 「承認待ち」リストに表示されない（自動で再アクティブ化） | 井上文 | 2025/11/09 | △ | [【BUG？】顧客からLINE公式アカウントをブロック→解除された後のFB側の動き：FB側の外部サービス連携>LINE管理ページにて、「](https://www.notion.so/BUG-LINE-FB-FB-LINE-2a577fe36e8280649af2e974dd04635c?pvs=21)⚠ [連携先切り替え提案～」という反応を示している](https://www.notion.so/BUG-LINE-FB-FB-LINE-2a577fe36e8280649af2e974dd04635c?pvs=21) |
| LINE-FC2-007 | ルームでメッセージを送受信 | 通常通りメッセージを送受信できる | 井上文 | 2025/11/09 | 〇 | 上記の「**⚠️ 連携先切り替え提案現在:** グループトーク**提案:** 1対1トーク」を特に操作はしていなくても、ブロック前と同じように
LINE⇆FBでメッセージのやり取りが出来ている |

### 8.1.4 F-C-1: 既に同じ1on1で連携済み（アクティブ状態で再追加）

**優先度**: P2

**事前条件**:

- follot-bizに顧客A（山田太郎さん）が登録されている
- 顧客AのLINEアカウントが既にfollot-bizと連携済み（アクティブ状態）
- follot-biz画面でルームリストに「山田太郎」のルームが表示されている

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FC1-001 | LINEアプリで、顧客A（山田太郎さん）のアカウントでログイン | ログイン成功 | 井上文 | 2025/11/09 | 〇 | 優先度: P2 |
| LINE-FC1-002 | follot-bizのLINE公式アカウントをブロックする | ブロック完了 | 井上文 | 2025/11/09 | 〇 |  |
| LINE-FC1-003 | follot-biz画面でルームリストを確認 | 「山田太郎」のルームは引き続き表示される | 井上文 | 2025/11/09 | 〇 |  |
| LINE-FC1-004 | 再度follot-bizのLINE公式アカウントのブロックを解除し、友だち追加する | 友だち追加完了 | 井上文 | 2025/11/09 | 〇? | 友達登録→ブロック→ブロック解除　の後で再度「友達登録をする」というコマンドは必要ないですよね？
この辺詳しくないので追加で何か対応が必要だったら連絡お願いします |
| LINE-FC1-005 | follot-biz画面で変化を確認 | 何も変化しない（理由: 既に正しく連携済みのため、追加のアクションは不要） | 井上文 | 2025/11/09 | × | LINE-FC2-004で記載したのと同じ状態

[【BUG】顧客からLINE公式アカウントをブロック→解除された後のFB側の動き：サイドバーのルームの表示が復帰しない](https://www.notion.so/BUG-LINE-FB-2a577fe36e82800abadcf60c752e9fea?pvs=21) |
| LINE-FC1-006 | ルームリストを確認 | 引き続き「山田太郎」のルームが表示される | 井上文 | 2025/11/09 | 〇 |  |
| LINE-FC1-007 | LINE管理画面を開く | 「承認待ち」リストに何も表示されない | 井上文 | 2025/11/09 | × | [【BUG？】顧客からLINE公式アカウントをブロック→解除された後のFB側の動き：FB側の外部サービス連携>LINE管理ページにて、「](https://www.notion.so/BUG-LINE-FB-FB-LINE-2a577fe36e8280649af2e974dd04635c?pvs=21)⚠ [連携先切り替え提案～」という反応を示している](https://www.notion.so/BUG-LINE-FB-FB-LINE-2a577fe36e8280649af2e974dd04635c?pvs=21) |
| LINE-FC1-008 | 通知を確認 | 特に通知は届かない | 井上文 | 2025/11/09 | 〇 |  |
| LINE-FC1-009 | メッセージを送受信 | 正常に動作する | 井上文 | 2025/11/09 | 〇 |  |

### 8.1.5 F-C-6: 既存顧客だがルーム未作成（完全新規連携）

**優先度**: P0

**事前準備**（テスト前提条件を作るための手順）:

1. 事前にF-C-2またはF-N-1を実施し、顧客A（山田太郎さん）をLINE連携済みにしておく
2. follot-biz画面で「山田太郎」のルームを開く
3. ルームで「！」をクリックしてサブカラムを開く
4. サブカラムの一番下の右端にあるゴミ箱アイコンをクリックしてルームを削除する
5. この時点で、以下の状態になっている：
    - 顧客A（山田太郎さん）がfollot-bizに登録されている
    - 顧客Aには過去のLINE userId情報（ContactDetail）が残っている
    - しかし、対応するルーム（Channel）は存在しない

**メモ**: この状況は、ユーザーがUIから手動でルームを削除した場合などを想定したテストです。

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FC6-001 | LINEアプリで、顧客A（山田太郎さん）のアカウントでログイン | ログイン成功 | 井上文 | 2025/11/09 | 〇 | 優先度: P0 |
| LINE-FC6-002 | follot-bizのLINE公式アカウントを友だち追加（再度） | 友だち追加完了 | 井上文 | 2025/11/09 | 〇 | 一度公式垢をブロック→友達：削除　を経て、再度公式垢を友達追加 |
| LINE-FC6-003 | 管理者に通知が届くか確認 | 「山田太郎さんとLINEで繋がりました」という通知が届く | 井上文 | 2025/11/09 | × | そのような通知は飛んでません |
| LINE-FC6-004 | follot-bizのルームリストを確認 | 「山田太郎」のルームが自動的に作成される | 井上文 | 2025/11/09 | 〇 |  |
| LINE-FC6-005 | LINE管理画面を開く | 「承認待ち」リストには表示されない（自動承認） | 井上文 | 2025/11/09 | △ | ここでは特に新規に提案されていないが、以下の症状が治った後で再度確認した方が良いかと思われる

[【BUG？】顧客からLINE公式アカウントをブロック→解除された後のFB側の動き：FB側の外部サービス連携>LINE管理ページにて、「](https://www.notion.so/BUG-LINE-FB-FB-LINE-2a577fe36e8280649af2e974dd04635c?pvs=21)⚠ [連携先切り替え提案～」という反応を示している](https://www.notion.so/BUG-LINE-FB-FB-LINE-2a577fe36e8280649af2e974dd04635c?pvs=21) |
| LINE-FC6-006 | ルームを開いてメッセージを送信 | 正常に送受信できる | 井上文 | 2025/11/09 | 〇 |  |
| LINE-FC6-007 | 顧客詳細を確認 | 連絡先にLINEが追加されている | 井上文 | 2025/11/09 | 〇 | 顧客管理ページ＆Bizルームのサブカラムの顧客情報どちらもLINE情報有り |

### 8.1.6 F-C-3: グループで連携中の顧客が1on1で友だち追加

**優先度**: P1

**事前条件**:

- **J-1（グループ参加テスト）が完了していること**
- follot-bizに顧客A（山田太郎さん）が登録されている
- 顧客AはLINEグループ「〇〇プロジェクト」でfollot-bizと連携中（J-1で作成）
- **重要**: 顧客Aは、follot-biz公式アカウントを個別には友だち追加していない状態

**⚠️ 注意**:
J-1でグループに参加した際に、follot-biz公式アカウントを既に個別に友だち追加している場合、このテストは実施できません。別のLINEアカウントを使用するか、未友だち追加のメンバーでテストしてください。

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FC3-001 | LINEアプリで、顧客A（山田太郎さん）のアカウントでログイン | ログイン成功 | 井上文 | 2025/11/16 | 〇 | 優先度: P1 |
| LINE-FC3-002 | follot-bizのLINE公式アカウントを個別に友だち追加する（グループ参加とは別に、1on1で友だち追加） | 友だち追加完了 | 井上文 | 2025/11/16 |  | グループの動作は色々修正が上がってからの方が良いかと思いスルー |
| LINE-FC3-003 | follot-biz「LINE管理画面」を開く | 「承認待ち」リストに「山田太郎」が表示される |  |  |  |  |
| LINE-FC3-004 | 承認待ち項目を確認 | 「現在グループで連携中 → 1on1に切り替えますか？」というメッセージが表示される |  |  |  |  |
| LINE-FC3-005 | 承認を実行 | 1. 承認成功メッセージが表示される<br>2. 「承認待ち」リストから該当項目が消える |  |  |  |  |
| LINE-FC3-006 | ルームリストを確認 | 同じルーム「山田太郎」が継続表示される（ルームは削除されない） |  |  |  | 既存のルームがグループ連携から1on1連携に切り替わる |
| LINE-FC3-007 | ルームを開く | 過去のグループメッセージ履歴がルーム内に表示される |  |  |  | 履歴が保持される |
| LINE-FC3-008 | ルームから1on1メッセージ送信 | LINEで正常に送受信できる |  |  |  |  |

### 8.1.7 F-C-5: 他サービス（ChatWork/Slack）で連携中の顧客がLINEで友だち追加

**優先度**: P1

**事前条件**:

- follot-bizに顧客A（山田太郎さん）が登録されている
- 顧客Aは現在ChatWork（またはSlack）でfollot-bizと連携中
    - **ChatWork連携の準備方法**: ChatWork連携用のテストドキュメントを参照してChatWork連携済み顧客を作成
- follot-biz画面でChatWorkルーム「山田太郎」が表示されている

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FC5-001 | LINEアプリで、顧客A（山田太郎さん）のアカウントでログイン | ログイン成功 |  | 2025/12/08 | 〇 | 優先度: P1 |
| LINE-FC5-002 | follot-bizのLINE公式アカウントを友だち追加 | 友だち追加完了 |  | 2025/12/08 | 〇 |  |
| LINE-FC5-003 | follot-biz「LINE管理画面」を開く | 「承認待ち」リストに「山田太郎」が表示される |  | 2025/12/08 | 〇 |  |
| LINE-FC5-004 | 承認待ち項目を確認 | 「現在ChatWorkで連携中 → LINEに切り替えますか？」というメッセージが表示される |  | 2025/12/08 | 〇 |  |
| LINE-FC5-005 | 承認を実行 | 1. 承認成功メッセージが表示される<br>2. 「承認待ち」リストから該当項目が消える |  | 2025/12/08 | 〇 |  |
| LINE-FC5-006 | Sidebar（ルームリスト）を確認 | 同じルーム「山田太郎」が継続表示される（ルームは削除されない） |  | 2025/12/08 | 〇 | ルームのアイコンがChatWorkからLINEに変わる |
| LINE-FC5-007 | ルームアイコンを確認 | ルームのアイコンがChatWorkアイコンからLINEアイコンに変わる |  | 2025/12/08 | 〇 |  |
| LINE-FC5-008 | ルームを開いてメッセージ送信 | LINEで正常に送受信できる |  | 2025/12/08 | 〇 |  |
| LINE-FC5-009 | 過去のメッセージを確認 | 過去のChatWorkメッセージも同じルーム内に表示される |  | 2025/12/08 | 〇 | 履歴が保持される

【追記】
残されたCWのグループからメッセージを発信してもFB側には反映されない |

### 8.1.8 F-N-2: 候補顧客なし（完全新規顧客）

**優先度**: P0

**⚠️ 注意**: このテストは**新規テナント環境**で実施します。既存のstaging環境では、顧客データが存在するため「候補顧客なし」の状態を作るのが困難です。

**実施方法**:

1. follot-bizで新しいテナントを作成
2. LINE連携設定を一から実施
3. 完全に真っさらな状態でテスト

**事前条件**:

- 新しいテナント環境（顧客データが存在しない）
- LINE連携設定が完了している
- 新しいLINEアカウント（follot-bizに全く登録されていない）
- 招待履歴も存在しない

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FN2-001 | LINEアプリで、新しいアカウント（例: 田中一郎さん）でログイン | ログイン成功 | LINEデヴェロッパーツールを新規に操作する必要があるそうなので現状確認できない | 2025/12/07 | 〇 | 優先度: P0

12/05　鍋谷さんが新規に組織テナント＆新規LINE公式アカウントを取得していたので、その際に確認できている
 |
| LINE-FN2-002 | follot-bizのLINE公式アカウントを友だち追加 | 友だち追加完了 |  | 2025/12/07 | 〇 | 12/05　鍋谷さんが新規に組織テナント＆新規LINE公式アカウントを取得していたので、その際に確認できている
 |
| LINE-FN2-003 | 管理者に通知が届くか確認 | 「新規顧客が自動登録されました: 田中一郎」という通知が届く |  | 2025/12/07 |  |  |
| LINE-FN2-004 | follot-bizのルームリストを確認 | 新しいルーム「田中一郎」が自動的に作成される（ルーム名はLINEのアカウント名） |  | 2025/12/07 | 〇 | 12/05　鍋谷さんが新規に組織テナント＆新規LINE公式アカウントを取得していたので、その際に確認できている
 |
| LINE-FN2-005 | LINE管理画面を開く | 「承認待ち」リストには表示されない（自動承認） |  | 2025/12/07 | 〇 | 12/05　鍋谷さんが新規に組織テナント＆新規LINE公式アカウントを取得していたので、その際に確認できている
 |
| LINE-FN2-006 | ルームを開いてメッセージを送信 | LINEで正常に送受信できる |  | 2025/12/07 | 〇 | 12/05　鍋谷さんが新規に組織テナント＆新規LINE公式アカウントを取得していたので、その際に確認できている
 |
| LINE-FN2-007 | 顧客一覧を確認 | 「田中一郎」が新規顧客として登録されている |  | 2025/12/07 | 〇 | 12/05　鍋谷さんが新規に組織テナント＆新規LINE公式アカウントを取得していたので、その際に確認できている
 |

**備考**: このテストは他のテストとは独立した環境で実施するため、テスト実施チェックリストでは別枠として扱います。

### 8.2 G-2: グループ参加・退出処理

### 8.2.1 J-1: グループに招待される

**優先度**: P1

**事前条件**:

- LINEグループ「〇〇プロジェクト」が存在する
- グループ内に複数のメンバーがいる

**重要な実装仕様**:

- ⚠️ LINEの仕様上、JOIN イベント時点ではグループメンバーの情報は取得できません
- ⚠️ 実際の顧客紐付けは、**グループ内で誰かがメッセージを送信した時点**で初めて行われます

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-J1-001 | LINEアプリで、グループ管理者または既存メンバーがfollot-biz公式アカウントをグループに招待 | follot-biz botがグループに参加完了 | 井上文 | 2025/11/16 | 〇？ | 優先度: P1

>グループ管理者または既存メンバー

既存メンバーとは一体(FBに登録済のLINE連携が済んでいるアカウント？) |
| LINE-J1-002 | 管理者に通知が届くか確認 | 「LINEグループ『〇〇プロジェクト』に参加しました」という通知が届く | 井上文 | 2025/11/16 | 〇？ | >LINEグループ「〇〇プロジェクト」が存在する
>「LINEグループ『〇〇プロジェクト』に参加しました」という通知が届く

これはLINEでグループを作成する際に、何かしらの手順を踏むことで[プロジェクト]という名称が付くモードがあるという事だろうか？

とりあえず分からないのでグループ作成時につけられる任意の名前として考えて、「〇〇プロジェクト」としておく

 |
| LINE-J1-003 | follot-bizのルームリストを確認 | **グループルームは作成されていない** | 井上文 | 2025/11/16 | 〇？ | JOIN イベント時点では何も作成されない

作成はされないが、既にFB内にルーム作成済の顧客からの招待を受けている状態である |
| LINE-J1-004 | グループ内で、LINEユーザー（例: 山田太郎さん）が「こんにちは」などのメッセージを送信 | メッセージ送信完了 | 井上文 | 2025/11/16 | 〇？ | LINE-J1-001の備考欄にも記載したが、そもそもFBと関りがないLINEユーザーからのメッセージの方が良いのか、
FBに登録がある情報からのLINEユーザーからのグループ招待でよかったのか

この辺の正解が分からないので何とも言えない

ひとまずFBボットと友達登録をしていない２アカウントのグループに招待し、一方のLINEユーザーからグループにメッセージを投下した |
| LINE-J1-005 | follot-biz「LINE管理画面」を開く | 「承認待ち」リストに新規LINEユーザーが表示される | 井上文 | 2025/11/16 | 〇 |  |
| LINE-J1-006 | 承認待ち項目を確認 | 1. 「メッセージ受信」というステータスが表示される<br>2. 送信されたメッセージのプレビューが表示される | 井上文 | 2025/11/16 | 〇 | もう一点
**メッセージ受信**の下に[〇○プロジェクト]という情報が入ってる |
| LINE-J1-007 | follot-bizの顧客リストとルームリストを確認 | 顧客リストにもルームリストにも何も表示されない | 井上文 | 2025/11/16 | 〇 | この時点では顧客やルームは自動作成されない（手動承認が必要）

[⚠️ 未紐付けLINEアカウントが1件あります]の通知は出ている |
| LINE-J1-008 | 承認待ち項目を承認 | 1. 承認成功メッセージが表示される<br>2. 「承認待ち」リストから該当項目が消える | 井上文 | 2025/11/16 | 〇 | どう承認するのか

LINE-J1-009の内容的に「**新規顧客として作成**」で良さそうなのでそれで対応する |
| LINE-J1-009 | follot-bizの顧客リストを確認 | メッセージ送信者が新規顧客として登録されている | 井上文 | 2025/11/16 | 〇 |  |
| LINE-J1-010 | ルームリストを確認 | グループ「〇〇プロジェクト」のルームが表示される | 井上文 | 2025/11/16 | ■(テスト項目側に問題あり) | 上記で承認連携したLINE顧客の名前(今回は「いの」)でルームが立てられている
グループ感はない

→グループ名でルームは立てられないのが正しいらしい |
| LINE-J1-011 | グループルームを開く | 保留されていたメッセージが表示されている |  |  |  |  |
| LINE-J1-012 | グループルームからメッセージを送信 | LINEで正常に送受信できる |  |  |  |  |

### 8.2.2 J-2: 複数メンバーがいるグループでの顧客紐付け

**優先度**: P2

**シナリオの背景**:
LINEの仕様上、botがグループに招待された時点では、グループメンバーの情報を取得できません。follot-bizは、グループ内で誰かがメッセージを送信した時点で、その送信者を特定し、顧客として紐付けます。このテストは、複数のメンバーがいるグループで、最初にメッセージを送信した人が正しく紐付けられることを確認します。

**⚠️ 注意**: LINEの仕様上、手動再現が困難な場合あり。エンジニアが擬似的に作り出すか、自然発生時のログ確認を推奨してください。

**事前条件**:

- LINEグループ「テストグループB」を作成する（複数のメンバーが参加している状態）
- グループ内のメンバーの一部はfollot-bizに未登録

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-J2-001 | LINEアプリで、follot-bizの公式アカウントを「テストグループB」に招待 | follot-biz botがグループに参加完了 | 井上文 | 2025/11/15 | 〇 | 優先度: P2 |
| LINE-J2-002 | 管理者に通知が届くか確認 | グループ参加通知が届く | 井上文 | 2025/11/15 | 〇 | タイトル：LINE グループ参加
内容：BotがLINEグループ「FB LINEグループテスト（友達済）」に参加しました
カテゴリー：通知
アクションタイプ：LINE_JOIN
作成日時：2025/11/15 16:00
更新日時：2025/11/15 16:19 |
| LINE-J2-003 | follot-bizのルームリストを確認 | **ルームは作成されていない** | 井上文 | 2025/11/15 | 〇 | この時点ではルームは作成されない |
| LINE-J2-004 | グループ内で、follot-bizに**未登録の新しいLINEアカウント**（例: 鈴木さん）が「はじめまして」とメッセージを送信 | メッセージ送信完了 | 井上文 | 2025/11/16 | △ | [[BUG?]LINEグループ連携：FBボット(公式垢)を招待したグループトークから、FB未登録のLINEアカウント２つからメッセージを投下した場合、FB側では別々のルームを立ててしまい、ちゃんとグループに対応したルームを生成できていない？](https://www.notion.so/BUG-LINE-FB-LINE-Biz-2ac77fe36e828063b821dc55afefe8bf?pvs=21)

初回のメッセージ自体は受け取れている様子 |
| LINE-J2-005 | follot-biz「LINE管理画面」を開く | 「承認待ち」リストに鈴木さんが表示される | 井上文 | 2025/11/16 | △ | 上記チケット参照

初回メッセージに関しては承認待ちにいっている |
| LINE-J2-006 | 承認待ち項目を確認 | 1. 「メッセージ受信」というステータスが表示される<br>2. 「はじめまして」というメッセージプレビューが表示される | 井上文 | 2025/11/16 | 〇 |  |
| LINE-J2-007 | follot-bizの顧客リストとルームリストを確認 | 顧客リストにもルームリストにも何も表示されない | 井上文 | 2025/11/16 | △ | この時点では顧客やルームは自動作成されない（手動承認が必要）

以前グループ連動した際にルーム＆顧客を削除したのに、
ルームリストに細長い名前のないルームとして残存してしまっているのでそれが今後影響するか否か |
| LINE-J2-008 | 承認ボタンをクリック | 1. 承認成功メッセージが表示される<br>2. 「承認待ち」リストから該当項目が消える | 井上文 | 2025/11/16 | △ | [承認ボタンをクリック]とあるが、[**既存顧客に紐付け][新規顧客として作成]**どちらをそうしていているのか不明

LINE-J2-009の内容的に新規(の方が良さそうなのでそちらで対応した |
| LINE-J2-009 | 顧客リストを確認 | 鈴木さんが新しい顧客として登録されている | 井上文 | 2025/11/16 | 〇 |  |
| LINE-J2-010 | ルームリストを確認 | 「テストグループB」のルームが作成されている | 井上文 | 2025/11/16 | × |  |
| LINE-J2-011 | ルームを開く | 「はじめまして」メッセージと鈴木さんが顧客として紐付いていることを確認 | 井上文 | 2025/11/16 | × | [[BUG?]LINEグループ連携：FBボット(公式垢)を招待したグループトークから、FB未登録のLINEアカウント２つからメッセージを投下した場合、FB側では別々のルームを立ててしまい、ちゃんとグループに対応したルームを生成できていない？](https://www.notion.so/BUG-LINE-FB-LINE-Biz-2ac77fe36e828063b821dc55afefe8bf?pvs=21) |
| LINE-J2-012 | グループルームからメッセージを送信 | LINEで正常に送受信できる | 井上文 | 2025/11/16 | △ | 同上 |

### 8.2.3 L-1: グループから退出/追放される（leave）

**優先度**: P1

**事前条件**:

- **J-1（グループ参加テスト）が完了していること**
- follot-bizと連携済みのLINEグループ「〇〇プロジェクト」が存在する
- follot-bizのルームリストに、グループメンバーに紐付いたルームが表示されている

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-L1-001 | LINEアプリで、グループ管理者がfollot-biz公式アカウントをグループから削除する（または、グループ自体を削除する） | 削除完了 | 井上文 | 2025/11/17 | 〇 | 優先度: P1 |
| LINE-L1-002 | 管理者に通知が届くか確認 | 「LINEグループ『〇〇プロジェクト』から退出しました」という通知が届く | 井上文 | 2025/11/17 | 〇 |  |
| LINE-L1-003 | Sidebar（ルームリスト）で、該当顧客のルームを確認 | 1. LINEアイコンが半透明になる<br>2. ⚠️警告バッジが表示される | 井上文 | 2025/11/17 | 〇 |  |
| LINE-L1-004 | ルームを開く | 「⚠️ LINE連携済みの顧客がいません」というオレンジ色の警告が表示される | 井上文 | 2025/11/17 | 〇 | システム内部では、グループ内の全メンバーのLINE連絡先が「非アクティブ」状態に更新される |

**設計決定（2025年10月27日）**: Bot再招待時は何もせず、メッセージ送信時に段階的に自動復旧する方針

**理由**:

1. Bot再招待時点では、Group Members API制約（無料プラン）により、誰がグループに残っているか不明
2. 退出済み顧客を誤って再アクティブ化するリスクを回避
3. メッセージを送信した顧客のみが実際にグループに残っていることが確実

**UI上での動作フロー**:

1. Bot退出 → bizトーク画面に警告表示、サイドバー未連携表示
2. Bot再招待 → 画面上は何も変化しない（警告・未連携表示継続）
3. 顧客Aがメッセージ送信 → メッセージ表示、警告消える、サイドバー連携済み表示
4. 顧客Bがメッセージ送信 → 顧客Bのメッセージも正常表示
5. 退出済み顧客Cは、メッセージを送らないため復旧しない（正しい状態）

### 8.3 G-3: 未登録ユーザーからのメッセージ受信処理

### 8.3.1 M-1: 1on1で未登録ユーザーからメッセージ受信

**優先度**: P1

**事前条件**:

- 新しいLINEアカウント（follot-bizに未登録）を用意する

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-M1-001 | LINEアプリで新しいアカウントでログイン | ログイン成功 | 井上文 | 2025/11/17 | 〇 | 優先度: P1 |
| LINE-M1-002 | follot-bizのLINE公式アカウントを友だち追加 | 友だち追加完了 | 井上文 | 2025/11/17 | 〇 |  |
| LINE-M1-003 | LINE管理画面を開く（友だち追加直後） | 1. 対象顧客候補がある場合: 「承認待ち」リストに新規LINEユーザーが表示される<br>2. 対象顧客候補が0の場合: この時点で自動登録される | 井上文 | 2025/11/17 | △ | >2. 対象顧客候補が0の場合: この時点で自動登録される

この機能については実装されていないが、
新規顧客登録のボタンを実装した時点で問題はないのではないかと思います
↓
と思ったけど、下のテスト内容的にメッセージがLINE管理画面に保存された状態って事を言いたいような気がする |
| LINE-M1-004 | 「はじめまして。資料をください」といったメッセージを送信 | メッセージ送信完了 | 井上文 | 2025/11/17 | 〇 |  |
| LINE-M1-005 | LINE管理画面を再確認 | 別のPendingContact（「メッセージ受信」ステータス）が作成される | 井上文 | 2025/11/17 | 〇 |  |
| LINE-M1-006 | 承認待ち項目を確認 | 1. 「メッセージ受信」というステータスが表示される<br>2. 「はじめまして。資料をください」というメッセージプレビューが表示される | 井上文 | 2025/11/17 | 〇 |  |
| LINE-M1-007 | follot-bizの顧客リストとルームリストを確認 | 顧客リストにもルームリストにも何も表示されない | 井上文 | 2025/11/17 | 〇 | この時点では顧客やルームは自動作成されない（手動承認が必要） |
| LINE-M1-008 | 承認ボタンをクリック | 1. 承認成功メッセージが表示される<br>2. 「承認待ち」リストから該当項目が消える | 井上文 | 2025/11/17 | 〇 | 承認方法も３つあるがどれでも問題ない |
| LINE-M1-009 | ルームリストを確認 | 新しいルームが作成されている | 井上文 | 2025/11/17 | 〇 |  |
| LINE-M1-010 | ルームを開く | 保留されていたメッセージ「はじめまして。資料をください」が表示されている | 井上文 | 2025/11/17 | 〇 |  |
| LINE-M1-011 | 顧客リストを確認 | 新しい顧客として登録されている | 井上文 | 2025/11/17 | 〇 |  |

### 8.3.2 M-2: グループで未登録ユーザーからメッセージ受信

**優先度**: P1

**事前条件**:

- **J-1（グループ参加テスト）が完了していること**
- LINEグループ「〇〇プロジェクト」にfollot-biz botが参加済み
- グループ内に新しいメンバー（follot-bizに未登録）を追加する

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-M2-001 | LINEグループ「〇〇プロジェクト」内で、新しいメンバーが「よろしくお願いします」とメッセージを送信 | メッセージ送信完了 |  |  |  | 優先度: P1、J-1の完了が前提 |
| LINE-M2-002 | follot-biz「LINE管理画面」を開く | 「承認待ち」リストに新規LINEユーザーが表示される |  |  |  |  |
| LINE-M2-003 | 承認待ち項目を確認 | 1. 「メッセージ受信」というステータスが表示される<br>2. 「よろしくお願いします」というメッセージプレビューが表示される |  |  |  |  |
| LINE-M2-004 | follot-bizのグループルーム「〇〇プロジェクト」を確認 | グループルームの参加者リストに新しいメンバーは追加されていない |  |  |  | この時点ではグループルームに顧客は追加されない（手動承認が必要） |
| LINE-M2-005 | 承認ボタンをクリック | 1. 承認成功メッセージが表示される<br>2. 「承認待ち」リストから該当項目が消える |  |  |  |  |
| LINE-M2-006 | 顧客リストを確認 | 新しい顧客として登録されている |  |  |  |  |
| LINE-M2-007 | グループルーム「〇〇プロジェクト」を開く | 1. 参加者リストに新しいメンバーが追加されている<br>2. 保留されていた「よろしくお願いします」メッセージが表示されている |  |  |  |  |
| LINE-M2-008 | グループルームからメッセージを送信 | LINEで正常に送受信できる |  |  |  |  |

---

## 9. H. ファイル送受信機能（機能テスト）

### 9.1 H-1: follot-biz → LINE ファイル添付

### 基本情報

- **対応ファイル形式**:
    - 画像（jpg, png, gif）: LINEの画像メッセージとして送信
    - PDF、動画（mp4）等: ダウンロードURLをテキストメッセージとして送信（LINE API制限）
- **ファイルサイズ制限**: 画像10MB、動画200MB（※実装では未チェック、API側でエラー）
- **複数ファイル**: 可能（各ファイルが個別メッセージとして送信）

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FUNC-046 | LINE連携ルームでファイル添付ボタンをクリック | ファイル選択ダイアログが表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-FUNC-047 | 画像ファイル（5MB）を添付して送信 | ファイルが正常にアップロードされ、メッセージが送信される | 井上文 | 2025/11/10 | 〇 | 4.92MBのデータで確認 |
| LINE-FUNC-048 | LINE側で画像確認 | 画像が正常に表示され、ダウンロード可能 | 井上文 | 2025/11/10 | 〇 |  |
| LINE-FUNC-049 | PDFファイルを添付して送信 | ダウンロードURLを含むテキストメッセージが送信される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-FUNC-050 | LINE側でPDF確認 | URLリンクをタップしてブラウザでダウンロード・閲覧可能 | 井上文 | 2025/11/10 | △？　×？ | LINE API制限により、ファイル本体ではなくURLリンクを送信

[【BUG？】LINE送信：FBからPDFや動画をLINEに向けて送信した場合、LINEチャット画面で[送信者の名前+データ情報]と[送信者の名前]のような形で、名前が二度送信されている](https://www.notion.so/BUG-LINE-FB-PDF-LINE-LINE-2a677fe36e8280929e33e97d31d2925a?pvs=21)

また、LINEの基本的な操作を知らないせいか、jpgのDLは出来たが、PDFに関してはDL方法が分からなかった |
| LINE-FUNC-051 | 動画ファイル（50MB）を添付して送信 | ダウンロードURLを含むテキストメッセージが送信される | 井上文 | 2025/11/10 | × | LINE API制限により、動画本体ではなくURLリンクを送信

[【BUG】Bizトーク：動画ファイルを認識できないのか、画像と同じデータ制限を受けてしまうので10MBまでのデータしか送信できない](https://www.notion.so/BUG-Biz-10MB-2a677fe36e8280219778e271fdcc3412?pvs=21) |
| LINE-FUNC-052 | LINE側で動画確認 | URLリンクをタップしてブラウザで再生可能 | 井上文 | 2025/11/10 | △ | １MB以下の動画で試した際には問題なかったが50MBの時にどのようになるかは不明

また、[LINE-FUNC-050]と同様に、[名前が二度出てくるのが鬱陶しく感じなくもない](https://www.notion.so/BUG-LINE-FB-PDF-LINE-LINE-2a677fe36e8280929e33e97d31d2925a?pvs=21) |

### 9.2 H-2: LINE → follot-biz ファイル受信

### 基本情報

- **対応ファイル形式**: 画像（image）、一般ファイル（file）
- **未対応（将来実装予定）**: 動画（video）、音声（audio）
- **ファイルサイズ制限**: 1GB以上のファイルは取り込まれず、メッセージにsuffixが追加される

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-FUNC-053 | LINEで小サイズ画像（1MB以下）を送信 | LINE側で画像が送信される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-FUNC-054 | bizTalk側で画像確認 | 画像が表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-FUNC-055 | 画像のダウンロード | 画像が正常にダウンロードできる | 井上文 | 2025/11/10 | × | [【BUG】チャット欄に投下された画像やファイルをDLできない](https://www.notion.so/BUG-DL-2a577fe36e828039b93be64d144903a6?pvs=21) |
| LINE-FUNC-056 | 画像のプレビュー | 画像が正常にプレビューされる | 井上文 | 2025/11/10 | 〇 |  |
| LINE-FUNC-057 | LINEでPDFファイルを送信 | LINE側でファイルが送信される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-FUNC-058 | bizTalk側でPDFファイル確認 | ファイルが表示され、ダウンロード可能 | 井上文 | 2025/11/10 | × | [【BUG】チャット欄に投下された画像やファイルをDLできない](https://www.notion.so/BUG-DL-2a577fe36e828039b93be64d144903a6?pvs=21) |
| LINE-FUNC-059 | 1GB以上のファイルを送信 | ファイルは取り込まれず、メッセージに「※添付ファイル「{ファイル名}」({サイズ}MB)はサイズが大きいため受信できませんでした」のsuffixが追加される | 井上文 | 2025/11/10 | 未確認 | そのようなデータが自分のスマホのストレージにないのでちょっと確認が難しそうです |

---

## 10. I. 返信・スレッド機能（機能テスト）

### 10.1 I-1: 社内スレッドの作成と投稿

### 基本情報

- **前提条件**: LINE連携済みルーム
- **重要**: 社内スレッドはfollot-biz内で完結し、LINEには送信されない
- **関連処理**: `src/hooks/channels/useDiscussion.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-THREAD-001 | bizトークルームで通常メッセージを表示し、「スレッド開始」ボタンをクリック | スレッド作成モーダルが表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-002 | モーダルで「社内スレッド」を選択して作成 | 社内スレッドが作成され、サブカラム（SubCol）に表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-003 | 社内スレッド内でメッセージを投稿 | メッセージが社内スレッドに表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-004 | LINE側の確認 | LINE側にメッセージが表示されない（送信されない） | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-005 | スレッドヘッダーの表示確認 | 外部スレッド用の背景色が表示されない（通常表示） | 井上文 | 2025/11/10 | 〇 |  |

### 10.2 I-2: 外部スレッドの作成と投稿

### 基本情報

- **前提条件**: LINE連携済みルーム
- **重要**: 外部スレッドはLINEと双方向同期され、`quoteToken`で連携

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-THREAD-006 | bizトークルームで通常メッセージを表示し、「スレッド開始」ボタンをクリック | スレッド作成モーダルが表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-007 | モーダルで「外部スレッド」を選択して作成 | 外部スレッドが作成され、サブカラム（SubCol）に表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-008 | スレッドヘッダーの背景色確認 | 外部スレッド用の薄オレンジの背景色が表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-009 | 外部スレッド内でメッセージを投稿 | メッセージが外部スレッドに表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-010 | LINE側でメッセージ確認 | 引用形式（吹き出し内に引用元表示）でメッセージが表示される | 井上文 | 2025/11/10 | 〇 | `quoteToken`使用 |
| LINE-THREAD-011 | LINE側での引用表示確認 | スレッド元メッセージへの引用として正しく紐付けられている | 井上文 | 2025/11/10 | 〇 |  |

### 10.3 I-3: LINE引用 → follot-bizスレッド変換

### 基本情報

- **重要**: LINEの引用機能（スワイプしてリプライ）がfollot-bizの外部スレッドに自動変換される

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-THREAD-012 | follot-bizから通常メッセージAを送信 | メッセージがLINE側に表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-013 | LINEでメッセージAに対してスワイプしてリプライ（引用）してメッセージBを送信 | LINE側で引用として表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-014 | follot-biz側でメッセージBの表示確認 | メッセージBが外部スレッドとして表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-015 | スレッド元の確認 | メッセージAがスレッド元として紐付けられている | 井上文 | 2025/11/10 | △？　×？ | メッセージに関してはスレッドとして返信が可能だが、
画像やpdf等の添付情報に返信を返すと、FB上ではスレッドという形にならず通常のメッセージとして送られてくる |
| LINE-THREAD-016 | サブカラム（SubCol）でのスレッド表示 | スレッドがサブカラムで正しく表示される | 井上文 | 2025/11/10 | 〇 |  |

### 10.4 I-4: follot-bizスレッド → LINE引用送信

### 基本情報

- **重要**: follot-bizの外部スレッドがLINEの引用機能に変換される

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-THREAD-017 | LINEから通常メッセージCを送信 | follot-biz側で受信確認される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-018 | follot-bizでメッセージCに対して外部スレッドを作成 | 外部スレッドが作成される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-019 | 外部スレッド内でメッセージDを投稿 | メッセージDがfollot-biz側のスレッドに表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-020 | LINE側でメッセージDの確認 | 引用形式（吹き出し内に引用元表示）で表示される | 井上文 | 2025/11/10 | 〇 | `quoteToken`使用 |
| LINE-THREAD-021 | LINEでの引用表示確認 | メッセージCへの引用として表示される | 井上文 | 2025/11/10 | 〇 |  |

### 10.5 I-5: 返信UI表示の確認

### 基本情報

- **コンポーネント**: `src/components/molecules/ReplyInfo/index.tsx`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-THREAD-022 | follot-bizで外部スレッドを作成してメッセージEを投稿 | メッセージEがLINEに送信される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-023 | LINE側でメッセージEに対して引用機能でメッセージFを送信 | LINE側で引用として表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-024 | follot-biz側のメッセージFで返信UI（ReplyInfo）の表示確認 | 返信UIが表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-025 | 返信元の表示確認 | 返信元がメッセージEであることが明示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-026 | 返信元へのジャンプ機能確認 | 返信UIをクリックすると返信元メッセージにジャンプできる（UIで対応している場合） | 井上文 | 2025/11/10 | LINE側の話なら〇

そうでないなら備考欄の通り | >返信UIをクリックすると返信元メッセージにジャンプできる
↑
確認方法不明

長い外部スレッドを作成すれば可能かと思い、返信元のメッセージが画面に映らなくなるまでスレッドを伸ばしてからLINEでリプライしたが、ジャンプは特にしていないように見えた |

### 10.6 I-6: 引用チェーンの追跡

### 基本情報

- **重要**: 複数階層の引用チェーンが正しく追跡される

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-THREAD-027 | follot-bizからメッセージG（通常）を送信 | LINE側に表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-028 | LINEでメッセージGに引用してメッセージHを送信 | follot-biz側で外部スレッドとして表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-029 | follot-bizでメッセージHのスレッドにメッセージIを追加投稿 | LINE側でメッセージGへの引用として表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-030 | LINEでメッセージIに引用してメッセージJを送信 | follot-biz側で同じスレッド内に表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-031 | 引用チェーンの追跡確認 | 全てのメッセージ（H, I, J）が正しいスレッドに紐付けられている | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-032 | 最初の外部メッセージの特定確認 | スレッド元がメッセージGとして正しく特定される | 井上文 | 2025/11/10 | 〇 |  |

### 10.7 I-7: 社内スレッドがLINEに送信されないことの確認

### 基本情報

- **重要**: 社内スレッドは絶対にLINEに送信されないことを確認

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-THREAD-033 | follot-bizで社内スレッドを作成 | 社内スレッドが作成される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-034 | 社内スレッド内でメッセージKを投稿 | メッセージKがfollot-biz側の社内スレッドに表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-035 | 社内スレッド内で追加メッセージLを投稿 | メッセージLがfollot-biz側の社内スレッドに表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-036 | LINE側の確認 | LINE側にはメッセージK、Lのいずれも表示されない | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-037 | follot-biz側での社内スレッド表示確認 | 社内スレッドが正常に表示され、メッセージK、Lが時系列順に表示される | 井上文 | 2025/11/10 | 〇 |  |

### 10.8 I-8: 外部スレッドのLINE同期確認

### 基本情報

- **重要**: 外部スレッドの双方向同期が正しく動作することを確認

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-THREAD-038 | follot-bizで外部スレッドを作成してメッセージMを投稿 | メッセージMがfollot-biz側のスレッドに表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-039 | LINE側でメッセージMの確認 | 引用形式でメッセージが表示される | 井上文 | 2025/11/10 | 〇 | `quoteToken`使用 |
| LINE-THREAD-040 | LINEでメッセージMに引用してメッセージNを送信 | LINE側で引用として表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-041 | follot-biz側でメッセージNの確認 | メッセージNがスレッド内に表示される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-042 | 双方向同期の確認 | follot-biz ↔ LINEで双方向にメッセージが正しく同期される | 井上文 | 2025/11/10 | 〇 |  |
| LINE-THREAD-043 | 引用チェーンの整合性確認 | 両サイドで引用チェーンが正しく表示される | 井上文 | 2025/11/10 | 〇？ | >両サイドで引用チェーン

厳密には分からないがニュアンス的に多分合っていると思われる
FB内のスレッドの中でさらに引用として表示されるもの？ |

---

## 11. エラーハンドリング（エラーテスト）★

### 11.1 H-1: API認証エラー

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-ERR-001 | 無効なチャネルアクセストークンで接続テスト | エラーメッセージ「認証に失敗しました」が表示される | 井上文 | 2025/11/10 |  | 確認方法不明 |
| LINE-ERR-002 | 無効なチャネルシークレットで署名検証 | エラーメッセージが表示され、処理が失敗する |  |  |  |  |

### 11.2 H-2: LINE連携エラー★

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-ERR-003 | 署名検証失敗時の動作 | 403 Forbiddenが返され、処理がスキップされる |  |  |  |  |
| LINE-ERR-004 | 不明なイベントタイプ受信 | ログに警告が記録され、200 OKが返される |  |  |  |  |

### 11.3 H-3: メッセージ送信失敗時のリトライ★

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-ERR-005 | LINE API一時的なエラー発生時 | リトライ処理が実行される |  |  |  |  |
| LINE-ERR-006 | リトライ上限到達時 | エラー通知が管理者に送信される |  |  |  |  |

### 11.4 H-4: グループ削除時の同期

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-ERR-007 | LINE側でグループを削除 | follot-biz側にleaveイベントが通知される | 井上文 | 2025/11/15 | 〇 | LINE公式サイトから引用：
>**グループの削除方法**自分以外のメンバーを全員退会させてから自分が退会することでグループを削除できます。

なので厳密にはFBボットがグループを作ってくれないと再現できないが、
LINEユーザー側で作ったグループからFB公式アカウントをメンバーから外した場合、
FBの通知に「[LINE グループ退出 / BotがLINEグループ「inoK様 (LINE)」から退出しました](https://follot-biz--mock-5p17rynz.web.app/#/businesschat/hn46pInKsZVE5nhdI9ns?tenant=IWWRVWzvkvxvWsliRUv8)」というメッセージを確認 |
| LINE-ERR-008 | グループ削除後のステータス確認 | bizTalkルームに「連携解除」の表示がある | 井上文 | 2025/11/15 | 〇？ | FBのBizトーク>該当ルームのtoast通知「LINEグループから公式アカウントが退出されています」というメッセージを確認 |
| LINE-ERR-009 | 削除後のメッセージ送信試行 | エラーメッセージが表示され、送信できない | 井上文 | 2025/11/15 | × | [[BUG]LINEグループ連携：FB公式アカウントがLINEのグループから除外されているのに、対応していたBizトークルームでメッセージを送信してもバリデーションが発生しないので遅れていないという事が分からない](https://www.notion.so/BUG-LINE-FB-LINE-Biz-2ac77fe36e828063b821dc55afefe8bf?pvs=21) |
| LINE-ERR-010 | 削除通知の確認 | 管理者に通知が送信される | 井上文 | 2025/11/15 | ？？？ | LINE-ERR-007　との差が分からない |

---

## 12. 回帰テスト

### 12.1 既存bizトーク機能への影響確認

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-REG-001 | LINE未連携のルームでメッセージ送受信 | 通常通りメッセージが送受信できる | 井上文 | 2025/11/12 | 〇 |  |
| LINE-REG-002 | LINE未連携のルームでファイル添付 | 通常通りファイルが送受信できる | 井上文 | 2025/11/12 | × |  |
| LINE-REG-003 | 他の外部サービス連携（ChatWork、Slack等）との共存 | 各サービスが正常に動作する | 井上文 | 2025/12/08 | 〇 |  |
| LINE-REG-004 | ルーム作成・削除機能 | 通常通りルームが作成・削除できる | 井上文 | 2025/12/08 | 〇 |  |
| LINE-REG-005 | 顧客管理機能 | 通常通り顧客が管理できる | 井上文 | 2025/12/08 | 〇 |  |
| LINE-REG-006 | メンバー管理機能 | 通常通りメンバーが管理できる | 井上文 | 2025/12/08 |  | どういう作業が対象になるのか？ |
| LINE-REG-007 | 通知機能 | 通常通り通知が送信される | 井上文 | 2025/12/08 | 〇 |  |
| LINE-REG-008 | 検索機能 | 通常通り検索ができる |  |  |  |  |
| LINE-REG-009 | LINE未連携ルームでのスレッド機能 | 社内スレッドが正常に動作する | 井上文 | 2025/12/08 | 〇 |  |

---

## 13. 統合テスト（エンドツーエンド）

### 13.1 完全なLINE連携フロー

| 項目ID | 操作手順 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-INT-072 | 1. テナント初期セットアップ（A-1）→ 2. 顧客登録（B-1またはC-1）→ 3. 招待メール送信（D-1）→ 4. 未承認アカウント承認（F-3）→ 5. メッセージング（F-1, F-2）→ 6. ファイル送受信（H-1, H-2）→ 7. スレッド機能（I-2, I-3, I-4） | 全ステップが正常に動作し、エンドツーエンドのコミュニケーションが成立する |  |  |  |  |
| LINE-INT-073 | 複数ルームでの同時運用 | 各ルームが独立して正常に動作する | 井上文 | 2025/12/08 | 〇 |  |
| LINE-INT-074 | 複数ユーザーでの同時操作 | 競合なく正常に動作する |  |  |  |  |

### 13.2 名前表示の統合テスト

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-INT-075 | follot-biz → LINE: メッセージ送信 | LINE側でBot名義で送信され、メッセージ先頭に「【follot-bizユーザーの表示名】」が付与される | 井上文 | 2025/11/17 | 〇 | 常にBot名義 |
| LINE-INT-076 | LINE → follot-biz: メッセージ受信 | follot-biz上でfollot-bizの名前が表示される（LINE名ではない） | 井上文 | 2025/11/17 | 〇 |  |
| LINE-INT-077 | LINEグループ内の社内メンバー発言 | follot-biz上でfollot-bizの表示名が表示される（LINE名ではない） | 井上文 | 2025/11/17 | ？？？ | 社内メンバー管理機能

グループ機能が色々修正された後で確認する必要がある |

---

## 14. バリデーションテスト

### 14.1 入力検証

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| LINE-VAL-001 | 空メッセージの送信試行 | エラーメッセージが表示される | 井上文 | 2025/11/17 | × | [バリデーションが発生しないが、そもそもなにも送信しない

本番でも同様の動作だがバリデが必要なのか](https://www.notion.so/BUG-Biz-2ad77fe36e8280f0a6b9ece682dbb255?pvs=21) |
| LINE-VAL-002 | 極端に長いメッセージの送信 | 適切に処理される、または文字数制限エラーが表示される | 井上文 | 2025/11/17 | × | LINEは5000文字制限

極端に長いメッセージ(4992文字以上)の送信はされない

文字数制限エラーは存在しない |
| LINE-VAL-003 | 特殊文字を含むメッセージの送信 | 正常に送受信される | 井上文 | 2025/11/17 | 〇 | [https://swift-smooth.com/character-list/](https://swift-smooth.com/character-list/)

ここで幾つかのグループをコピペして投下してみたが特にLINE側で表示されないという事はなかった |
| LINE-VAL-004 | 絵文字を含むメッセージの送信 | 正常に送受信される | 井上文 | 2025/11/17 | 〇 |  |

---

## テスト環境情報

- **テスト環境URL**: [https://follot-biz--mock-5p17rynz.web.app/](https://follot-biz--mock-5p17rynz.web.app/) など。URLは動的に変更される
- **テストアカウント**: 別途共有
- **ブラウザ**: Chrome最新版、Safari最新版、Edge最新版
- **デバイス**: PC、タブレット、スマートフォン
- **LINEテスト環境**: 開発用LINE公式アカウント使用

---

## 注意事項

### テスト実施前の準備

1. LINE公式アカウントの作成（Messaging API有効化）
2. チャネルアクセストークン、チャネルシークレット、チャネルIDの取得
3. Webhook URLの設定
4. テスト用LINEアカウントの準備（最低3アカウント）
5. 各ロール（customer, guest, user, manager, admin, owner）のテストアカウント準備

### テスト実施時の注意点

1. **ロール別テスト**: 未承認アカウントのメッセージ可視性は必ず全ロールでテストすること
2. **名前表示**: 各方向（FB→LINE、LINE→FB）で正しい名前が表示されることを確認
3. **未承認アカウント**: 承認前後でメッセージの可視性が変わることを確認
4. **スレッド機能**: 社内スレッドと外部スレッドの違いを明確に理解してテストすること
5. **統合テスト**: エンドツーエンドのフロー（LINE-INT-072）は必ず実施すること
6. **エラーテスト**: 実環境では実施困難な項目（API認証エラー等）はテスト環境で模擬すること
7. **LINE固有機能**:
    - 招待メール送信機能（QRコード生成、ベーシックID自動取得）を必ずテスト
    - refパラメータは非対応（通常の未承認アカウント承認フローで承認）
    - 社内メンバー連携は個人OAuth不可（Bot名義のみ）
    - 表示名プレフィックス（【名前】）が常に付与されることを確認

### データ整合性の確認

- 各テスト後、以下の点をUI上で確認：
    1. メッセージが正しい時系列で表示される
    2. 送信者名が正しく表示される
    3. ファイルが正しくダウンロードできる
    4. 未承認アカウントの状態が正しく管理される
    5. スレッドが正しい親子関係で表示される
    6. 社内スレッドがLINEに送信されない
    7. 外部スレッドがLINEと双方向同期される
    8. 招待メールのQRコードが正しく生成される

### テスト完了基準

- すべての必須テスト項目（UI、FUNC、AUTH、INT、THREAD）が「合格」となること
- 統合テスト（LINE-INT-072）が成功すること
- ロール別権限テスト（未承認アカウントのメッセージ可視性）が全ロールで成功すること
- スレッド機能テスト（LINE-THREAD-001〜043）が成功すること
- 回帰テスト（LINE-REG-001〜009）で既存機能に影響がないこと
- 招待メール送信機能（D-1）が成功すること