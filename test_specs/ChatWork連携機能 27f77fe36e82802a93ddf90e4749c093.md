# ChatWork連携機能

# 【テスト仕様書】ChatWork連携機能

## 基本情報

- **作成日**: 2025年10月1日
- **対象バージョン**: リリース前最終版
- **テスト対象**: ChatWork連携機能全般（OAuth認証、メッセージ送受信、メンション、ファイル転送、Pending Contact管理、返信・スレッド機能）
- **関連実装**:
    - フロントエンド: `src/components/ecosystems/ChatWorkManagement/`, `src/components/organisms/MessageForm/`, `src/hooks/useUserIntegration.ts`, `src/core/useCases/chatworkUseCase.ts`, `src/hooks/channels/useDiscussion.ts`
    - バックエンド: `functions-node22/src/webhooks/chatwork.ts`, `functions-node22/src/adapters/chatworkAdapter.ts`, `functions-node22/src/adapters/chatworkThreadAdapter.ts`, `functions-node22/src/sendMessageToChatWork.ts`

---

## テスト実施前の事前準備

### 必要なChatWorkアカウント

テストを実施するには、以下のChatWorkアカウントを事前に用意してください：

### 1. テナント連携用アカウント（1アカウント）

- **用途**: テナント全体のAPIトークン取得用
- **実施内容**: 管理者がOAuth認証を実行
- **備考**: テナント全体のChatWork連携に使用

### 2. ユーザー個人連携用アカウント（最低1アカウント）

- **用途**: ユーザー個人のChatWork認証テスト
- **実施内容**: 各ユーザーが個人でOAuth認証を実行
- **備考**:
    - 個人認証ありの場合、メッセージに`[FB]`プレフィックスが**付かない**
    - 個人認証なし（テナント認証のみ）の場合、`[FB]`プレフィックスが**付く**

### 3. 顧客用アカウント（最低2アカウント）

- **用途**: ChatWorkルーム招待〜Pending Contact承認フローのテスト
- **実施内容**: 顧客役としてChatWorkルームに参加
- **備考**: 複数顧客でのテストシナリオに対応するため2アカウント以上推奨

---

## 対象URL/画面と具体的なアクセス方法

### テナントのChatWork連携設定（OAuth実行）

- **URL**: `/settings/tenants`
- **遷移方法**:
    1. 「テナント設定」から「テナント情報」を開く
    2. 対象テナントの「編集」ボタンをクリック
    3. 「連携設定」タブを選択
    4. 「外部メッセージサービス連携設定」セクションを確認
    5. Chatwork欄の「設定開始」または「設定変更」ボタンをクリック

### ChatWork管理画面（連携承認待ちの承認など）

- **URL**: `/external-services-management/chatwork`
- **遷移方法**（以下いずれかの方法）:
    - **方法1**: 上記のテナント連携設定画面で、Chatwork欄の「詳細管理」ボタンをクリック
    - **方法2**: bizトークルーム画面で、承認待ち連絡先がある場合、画面右上に表示される通知メッセージをクリック
    - **方法3**: bizトークルーム画面のサブカラム（右側パネル）の「概要」セクションに表示される警告バナーをクリック

### ユーザー個人のChatWork連携設定

- **URL**: `/settings/users`
- **遷移方法**:
    1. 「テナント設定」から「アカウント一覧」を開く
    2. 対象ユーザーの「編集」ボタンをクリック
    3. 「連携設定」タブを選択
    4. 「個人外部サービス連携」セクションを確認
    5. Chatwork欄の「個人認証」ボタンをクリック

### bizTalkルームのChatWork連携設定

- **URL**: `/businesschat`（各ルーム）
- **遷移方法**:
    1. bizトーク画面で「!」を押す
    2. 画面右側のサブカラム（SubCol）で「概要」セクションを確認
    3. 「連携設定」欄を探す
    4. 「連携サービス」の「ChatWork」を選択
        1. 「設定」ボタンをクリック

### スレッド表示

- **表示場所**: bizトーク画面の右側サブカラム（SubCol）
- **見た目**: Slackのスレッド表示と同様の形式
- **アクセス方法**: メッセージの「スレッド」ボタンまたはバッジをクリック

---

## 1. UI表示テスト

*注: 方針B（統合）を採用し、UI表示テストは統合テスト（2章以降）に含まれています。このセクションは画面構成の理解を助けるための参考情報として残しています。*

### 1.1 ChatWork連携設定画面（統合済み）

**統合先**: セクション 2.1 A-1: ChatWorkアカウント連携（OAuth認証フロー）

以下のUI要素は、実際のOAuth認証フローのシナリオテスト（CW-INT-001〜020）の中で確認します:

- 未連携状態の「設定開始」ボタン表示
- モーダル内の「Chatwork側で設定が必要な情報」セクション（折りたたみ可能）
- OAuth リダイレクトURLとWebhook URLの表示とコピー機能
- 認証方式選択（APIトークン / OAuth認証）
- 各認証方式に応じた入力フィールド表示
- Webhookトークンフィールド（テナント連携のみ表示）
- OAuth認証ボタンと認証完了後の確認表示
- 接続テストと保存機能
- 連携済み状態の表示（アカウント名、設定変更・詳細管理ボタン）

### 1.2 bizトーク画面でのChatWork関連UI

### 基本情報

- **URL**: `/businesschat`
- **コンポーネント**: `src/components/environments/CustomerChat/`, `src/components/ecosystems/SubCol/content-info/`
- **参考**: `docs/test/03_businesschat.md` のUI表示テストに準拠

*注: 以下のUI要素は統合テスト（2章以降）で実際の操作を通じて確認します。このセクションは画面構成の理解を助けるための参考情報です。*

| 項目ID | 確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-UI-021 | bizトーク画面にアクセス | サイドバーに顧客名ごとのルームリストが表示される | 井上(文) | 2025/10/02 | 〇 | Teamチャットとの差異確認 | 2025/11/01　〇 |  |
| CW-UI-022 | ChatWork連携済みルームのサイドバー表示 | ルーム名の下にChatWorkアイコンが表示される | 井上(文) | 2025/10/02 | 〇 | `/assets/images/external_service/chatwork.png`
↑404画面 | 2025/11/01　〇 |  |
| CW-UI-023 | 情報パネル（「！」アイコン）を開く | 右肩の「！」アイコンをクリックすると情報パネルが開く | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/01　〇 |  |
| CW-UI-024 | 情報パネルのタブ表示 | パネル上部に「表示概要」「顧客」「ノート」のタブが表示される | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/01　〇 |  |
| CW-UI-025 | 情報パネルのアコーディオンメニュー | 「顧客リスト」「ルーム情報」「メンバーリスト」のアコーディオンメニューが表示され、開閉できる | 井上(文) | 2025/10/02 | 〇 | 顧客/メンバー一覧/ルーム情報 | 2025/11/01　〇 |  |
| CW-UI-026 | ルーム情報 > 外部サービス連携設定の表示 | ChatWorkアイコンと「Chatwork」の表示、「設定」ボタンが表示される | 井上(文) | 2025/10/02 | 〇 | `channel-external-service-form.tsx` | 2025/11/01　〇 |  |
| CW-UI-027 | 外部サービス連携設定「設定」ボタンをクリック | 「外部サービス連携設定」モーダルが開く | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/01　〇 |  |
| CW-UI-028 | 連携設定モーダル内の表示 | 「連携サービス」ドロップダウンに「Chatwork」が選択肢として表示される | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/01　〇 |  |
| CW-UI-029 | Chatwork選択時の表示 | 「Chatwork ルーム選択」フィールドと「ルーム一覧を取得」ボタンが表示される | 井上(文) | 2025/10/02 | 〇 | `ChatWorkRoomSelector.tsx` | 2025/11/01　〇 |  |
| CW-UI-030 | ChatWorkルーム選択UI | ルーム一覧取得後、ドロップダウンでルームを選択できる | 井上(文) | 2025/10/02 | 〇 | 重複使用時は警告表示 | 2025/11/01　〇 |  |
| CW-UI-031 | 顧客リストアコーディオン（ChatWork連携済み） | 各顧客の横に「CW招待」ボタンが表示される | 井上(文) | 2025/10/02 | 〇 | `customer-list.tsx` | 2025/11/27　〇 |  |
| CW-UI-032 | 顧客リストアコーディオン（ChatWork連携なし） | 「CW招待」ボタンが表示されない | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/27　〇 |  |
| CW-UI-033 | ChatWork招待ボタンをクリック | 「ChatWork招待 - [顧客名]」モーダルが開く |  |  |  | `ChatWorkInviteModal.tsx` | 2025/11/27　〇 |  |
| CW-UI-034 | ChatWork招待モーダル内の表示 | 「ChatWorkルームID」、メールアドレス、追加メッセージ入力欄が表示される |  |  |  |  | 2025/11/27　△ | [【BUG】ChatWork連携：Bizトークのルーム>(サブカラム)顧客からCW招待を飛ばそうとするとINTERNALエラーが発生し、実行できない](https://www.notion.so/BUG-ChatWork-Biz-CW-INTERNAL-2b877fe36e82809d964dd2b3f909d61c?pvs=21) |
| CW-UI-035 | 連携済み顧客のChatWork招待ボタン | 既にChatWork連携済みの顧客は「連携済み」ボタンが無効化される | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/27　〇 |  |
| CW-UI-036 | Pending Contact警告バナー表示 | 未承認顧客がいる場合、情報パネルの概要タブに「⚠️ 未紐付けChatworkアカウント」警告バナーが表示される | 井上(文) | 2025/10/02 | 〇 | クリックで管理画面へ遷移 | 2025/11/27　〇 |  |
| CW-UI-037 | メンバーリストのChatWork連携表示 | ChatWork連携済みメンバーに「ChatWork」ステータスが表示される | 井上(文) | 2025/10/02 | 〇 | `members.tsx` | 2025/11/27　〇 | 名前の後ろに(ChatWork)と付く |
| CW-UI-038 | メッセージフォームのファイル添付制限表示 | ChatWork連携ルーム（社内スレッド以外）で複数ファイル添付時にエラーメッセージが表示される | 井上(文) | 2025/10/02 | ×：画像を送信してもCW側に反映されない(1件だけしか添付できない制限は問題なし) | 「ChatWork連携ルームでは1つのメッセージに1つのファイルのみ添付できます」 | 2025/11/27　〇 | [【BUG】CW連携：チャットで添付画像(1点のみ)を送ってもCW側に反映されない](https://www.notion.so/BUG-CW-1-CW-28077fe36e82809daee5d5baeba74753?pvs=21) |

---

## 2. A. テナント初期セットアップ（統合テスト）

### 2.1 A-1: ChatWorkアカウント連携（OAuth認証フロー）

### 基本情報

- **前提条件**: テナント管理者（admin/owner）でログイン済み
- **URL**: `/settings/tenants`
- **関連処理**: `functions-node22/src/chatWorkOAuthRedirect.ts`, `functions-node22/src/tenantIntegrationApi.ts`
- **統合**: セクション1.1のUI表示テストをこのシナリオに統合

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-INT-001 | `/settings/tenants` にアクセス | テナント設定画面が表示される | 井上(文) | 2025/10/01 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-002 | 対象テナントの「編集」ボタンをクリック | テナント編集モーダルが開く | 井上(文) | 2025/10/01 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-003 | 「連携設定」タブを選択 | 「外部メッセージサービス連携設定」セクションが表示される | 井上(文) | 2025/10/01 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-004 | 【UI確認】未連携状態の表示 | Chatwork欄に「設定開始」ボタンが表示される | 井上(文) | 2025/10/01 | △ | セクション1.1 CW-UI-002

井上：[初期設定を開始]or[設定変更] | 2025/11/01　〇 |  |
| CW-INT-005 | 「設定開始」ボタンをクリック | モーダル「Chatwork 連携設定」が開く | 井上(文) | 2025/10/01 | 〇 | セクション1.1 CW-UI-004 | 2025/11/01　〇 |  |
| CW-INT-006 | 【UI確認】モーダル内「Chatwork側で設定が必要な情報」セクション表示 | 折りたたみ可能なセクションが表示される | 井上(文) | 2025/10/01 | 〇 | セクション1.1 CW-UI-005 | 2025/11/01　〇 |  |
| CW-INT-007 | 「Chatwork側で設定が必要な情報」を展開 | 「OAuth リダイレクトURL」と「Webhook URL」が表示され、各URLに「コピー」ボタンがある | 井上(文) | 2025/10/01 | 〇 | セクション1.1 CW-UI-006

井上：コピーボタンを押下した際にPC側から特に反応がないので、コピーが成功しているか判別できないが問題ないか | 2025/11/01　×

Webhookの入力画面が消えている |  |
| CW-INT-008 | URLコピーボタンをクリック | クリップボードにURLがコピーされる | 井上(文) | 2025/10/01 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-009 | 【外部操作】ChatWork管理画面でOAuthアプリケーションを作成 | リダイレクトURLとWebhook URLを設定し、クライアントID/シークレット/Webhookトークンを取得 |  |  |  | ChatWork側の操作 | 2025/11/01　×

Webhookが絡むので一旦スルー |  |
| CW-INT-010 | 【UI確認】「認証方式」選択UI表示 | 「APIトークン」と「OAuth認証（セキュア）」のラジオボタンが表示される |  |  |  | セクション1.1 CW-UI-022 | 2025/11/01　〇 |  |
| CW-INT-011 | 「OAuth認証（セキュア）」を選択 | クライアントID、クライアントシークレット入力フィールド、OAuth認証ボタンが表示される |  |  |  | セクション1.1 CW-UI-024 | 2025/11/01　〇 |  |
| CW-INT-012 | 【UI確認】Webhookトークン入力フィールド表示（テナント連携） | 「Webhookトークン」入力フィールドと説明文が表示される |  |  |  | セクション1.1 CW-UI-025 | 2025/11/01　×

Webhookの入力画面が消えている |  |
| CW-INT-013 | ChatWorkから取得したクライアントID、シークレット、Webhookトークンを入力 | 各フィールドに正しく入力される |  |  |  |  | 2025/11/01　×

Webhookの入力画面が消えている
それ以外はOK |  |
| CW-INT-014 | 「Chatworkで OAuth認証を開始」ボタンをクリック | ChatWorkのOAuth認証画面（新規ウィンドウ）が開く |  |  |  | セクション1.1 CW-UI-027 | 2025/11/01　×

Webhookの入力画面が消えている
それ以外はOK |  |
| CW-INT-015 | ChatWork側で認証を許可 | OAuth認証ウィンドウが閉じ、元のモーダルに戻る |  |  |  |  | 2025/11/01　×

Webhookの入力画面が消えている
それ以外はOK |  |
| CW-INT-016 | 【UI確認】OAuth認証完了後の表示 | 「✅ OAuth認証が完了しました」と表示される |  |  |  | セクション1.1 CW-UI-028 | 2025/11/01　×

Webhookの入力画面が消えている
それ以外はOK |  |
| CW-INT-017 | 「接続をテスト」ボタンをクリック | 接続テストが実行され、成功メッセージが表示される |  |  |  | セクション1.1 CW-UI-029, CW-UI-030 | 2025/11/01　×

Webhookの入力画面が消えている
それ以外はOK |  |
| CW-INT-018 | 「保存」ボタンをクリック | 設定が保存され、モーダルが閉じる |  |  |  |  | 2025/11/01　×

Webhookの入力画面が消えている
それ以外はOK |  |
| CW-INT-019 | 【UI確認】連携済み状態の表示 | Chatwork欄に連携済みアカウント名、「設定変更」「詳細管理」ボタンが表示される |  |  |  | セクション1.1 CW-UI-003, CW-UI-031 | 2025/11/01　△
それ以外にも「削除」「一時停止」ボタンがある |  |
| CW-INT-020 | 設定画面を再読み込み | 連携状態が維持され、連携済み情報が表示される |  |  |  |  | 2025/11/01　〇 |  |

### 2.1-alt A-1-alt: ChatWorkアカウント連携（APIトークン方式）

### 基本情報

- **前提条件**: テナント管理者（admin/owner）でログイン済み
- **URL**: `/settings/tenants`
- **関連処理**: `functions-node22/src/tenantIntegrationApi.ts`
- **備考**: OAuth認証方式（2.1）と比較して簡易だが、全権限でのアクセスとなる

**⚠️ 重要**: このテストを実施する場合、事前に2.1で設定したOAuth認証を削除する必要があります。

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-INT-021 | 【前提】2.1でOAuth設定済みの場合、「設定変更」→ 連携解除を実行 | 連携が解除され、「設定開始」ボタンが表示される | 井上(文) | 2025/10/03 | △

[設定変更]ボタンは存在するが、そこから[連係解除]ボタン及びそれらしい導線は見当たらず
[設定変更]が見えている段階で[設定削除]というのが存在する | OAuth/APIトークン方式は排他的 | 2025/11/01　〇 |  |
| CW-INT-022 | `/settings/tenants` にアクセス | テナント設定画面が表示される | 井上(文) | 2025/10/03 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-023 | 対象テナントの「編集」ボタンをクリック | テナント編集モーダルが開く | 井上(文) | 2025/10/03 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-024 | 「連携設定」タブを選択 | 「外部メッセージサービス連携設定」セクションが表示される | 井上(文) | 2025/10/03 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-025 | 「設定開始」ボタンをクリック | モーダル「Chatwork 連携設定」が開く | 井上(文) | 2025/10/03 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-026 | 【UI確認】「認証方式」で「APIトークン」を選択 | APIトークン入力フィールドと説明文「APIトークンは設定が簡単ですが、全権限でのアクセスとなります」が表示される | 井上(文) | 2025/10/03 | 〇 | セクション1.1 CW-UI-023 | 2025/11/01　〇 |  |
| CW-INT-027 | 【外部操作】ChatWork管理画面でAPIトークンを発行 | APIトークンを取得 | 井上(文) | 2025/10/03 | 〇 | ChatWork側の操作 | 2025/11/01　〇 |  |
| CW-INT-028 | APIトークンとWebhookトークンを入力 | 各フィールドに正しく入力される | 井上(文) | 2025/10/03 | 〇 | 井上：Webhookについてはあっても無くても登録は可能らしい | 2025/11/01　×

Webhookの入力画面が消えている
それ以外はOK |  |
| CW-INT-029 | 「接続をテスト」ボタンをクリック | 接続テストが実行され、成功メッセージが表示される | 井上(文) | 2025/10/03 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-030 | 「保存」ボタンをクリック | 設定が保存され、モーダルが閉じる | 井上(文) | 2025/10/03 | 〇 |  | 2025/11/01　〇 |  |
| CW-INT-031 | 【UI確認】連携済み状態の表示 | Chatwork欄に連携済みアカウント名、「設定変更」「詳細管理」ボタンが表示される | 井上(文) | 2025/10/03 | 〇 |  | 2025/11/01　△
それ以外にも「削除」「一時停止」ボタンがある |  |
| CW-INT-032 | 設定画面を再読み込み | 連携状態が維持され、連携済み情報が表示される |  |  |  |  | 2025/11/01　〇 |  |

## 3. B. 顧客登録（UI手動入力パターン）（統合テスト）

### 3.1 B-1: 新規顧客の手動登録とChatWorkルーム連携

### 基本情報

- **前提条件**: テナント初期セットアップ完了（2.1または2.1-alt）
- **関連処理**: `functions-node22/src/webhooks/chatwork.ts`, `functions-node22/src/functions/pendingContactApproval.ts`
- **フロー参照**: CW-INT-051以降は5.1（CW-INT-033〜050）のbizTalkルームセットアップフローを実施

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-INT-050 | 顧客管理画面で新規顧客を手動入力（メールアドレス含む） | 顧客情報が正常に保存される | 井上(文) | 2025/10/01 | 〇 |  | 2025/11/01　△
Chatwork連携していた顧客が参加していた連携ルームを削除した後、前述の顧客のメールアドレスからメールを送信したところ、メールが届いていないようだった(PCのデスクトップ通知には連絡が来るが叩くと期限切れで見れなくなったmock環境+今見てるmock環境には通知が届いていなかった)　要検証 |  |
| CW-INT-051 | **以降、5.1のフロー（CW-INT-033〜050）を実施**: bizTalkルーム作成 → ChatWork連携設定 → 顧客リストにCW招待ボタン表示確認 | 5.1のテスト項目がすべて成功する | 井上(文) | 2025/10/01 |  | セクション5.1参照 |  |  |
| CW-INT-052 | 情報パネル > 顧客リスト > 対象顧客の「CW招待」ボタンをクリック | 「ChatWork招待 - [顧客名]」モーダルが開く | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-033 | 2025/11/27　〇 |  |
| CW-INT-053 | 【UI確認】モーダル内の表示 | 「ChatWorkルームID」、メールアドレス、追加メッセージ入力欄が表示される | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-034 | 2025/11/27　〇 |  |
| CW-INT-054 | 招待メッセージを入力し「ChatWork招待を送信」ボタンをクリック | 招待メールが顧客に送信される | 井上(文) | 2025/10/02 | 〇 | 井上：別のGoogleアカウントで該当の招待URLを叩いたところ、[とも6.5.0.4]という謎のアカウントで「こにゃにゃちわ」というメッセージを送っていた(CW側の対応？) | 2025/12/03　〇 |  |
| CW-INT-055 | 顧客が招待リンクをクリックしてChatWorkルームに参加 | ChatWorkルームに顧客が参加する | 井上(文) | 2025/10/02 | 〇 | 参加時点ではWebhook発火せず | 2025/12/03　〇 | 参加したことで管理ページに情報が飛ぶ |
| CW-INT-056 | 顧客がChatWorkルームから初回メッセージを送信 | 1. メッセージがfollot-bizに同期される<br>2. Webhookによりpending contactが作成される | 井上(文) | 2025/10/02 | 〇 | 初回メッセージ送信でWebhook発火

井上：CW側でメッセージを送っても「**Chatwork管理**」側にはメッセージが反映されるけど、ルームのメインチャットに反映されない

田中：紐付けがされていないから、FB内でいうところの誰からのメッセージなのか確定できないので、「連携承認待ち」になります。紐付けすると、その人のメッセージとして、ルームに表示されます | 2025/12/03　〇 | メッセージを飛ばした事で(上記でまだ紐づけられていなければ)管理ページに情報が飛ぶ |
| CW-INT-057 | bizトーク画面で警告バナー表示を確認 | 情報パネルの概要タブに「⚠️ 未紐付けChatworkアカウント」警告バナーが表示される | 井上(文) | 2025/10/02 | 〇 | セクション1.2 CW-UI-036 | 2025/12/03　？ | 確認不足 |
| CW-INT-058 | admin/owner/managerでpending contactメッセージを確認 | メッセージが`pendingApproval=true`で保存され、メッセージ内容が表示される | テスト不要 | テスト不要 | テスト不要 | 権限による可視性制御

田中：ゴメン。テスト項目の削除漏れだ。CW-INT-058CW-INT-059は不要で。 | テスト不要 | テスト不要 |
| CW-INT-059 | user/guest/customerでpending contactメッセージを確認 | 「(送信を準備しています)」と表示され、内容は閲覧できない | テスト不要 | テスト不要 | テスト不要 | 権限による可視性制御

田中：ゴメン。テスト項目の削除漏れだ。CW-INT-058CW-INT-059は不要で。 | テスト不要 | テスト不要 |
| CW-INT-060 | 警告バナーをクリック → ChatWork管理画面（/external-services-management/chatwork）に遷移 | 「連携承認待ち」タブにpending contactが表示される | 井上(文) | 2025/10/02 | 〇 |  | 2025/12/03　〇 |  |
| CW-INT-061 | 対象のpending contactの「承認」ボタンをクリック | 承認確認ダイアログが表示され、承認完了 | 井上(文) | 2025/10/02 | 〇

失敗した際のメッセージ背景の「承認待ち」のステータスが、ヌルっと「承認済」に切り替わったのと、FB内通知とデスクトップ通知は入ってきてたんですけど、さっき貼った「承認済み」に切り替わったChatWork管理画面からどこかに移動したりはしなかった | 井上：[この顧客に紐づける][紐付け設定][承認しない]の選択肢しかなく、「承認」が前者2肢のどちらを差してるか不明

[この顧客に紐づける]を選択した際に、ポップアップで「～を顧客として承認しますか」と出てきたので恐らくこちら | 2025/12/03　〇 |  |
| CW-INT-062 | bizトーク画面に戻り、過去のメッセージ表示を確認 | 過去の全メッセージが時系列順に表示される | 井上(文) | 2025/10/02 | 〇 |  | 2025/12/03　〇 |  |
| CW-INT-063 | 双方向でメッセージを送受信 | メッセージが正常に送受信できる | 井上(文) | 2025/10/02 | ×：FB側から送ったメッセージがそのままCW側からのメッセージとしてFBで取得してしまう(二重で同じコメントが載る) |  |  |  |
| CW-INT-064 | 【UI確認】顧客リストで承認済み顧客のボタン表示 | 「連携済み」ボタンが無効化される | 井上(文) | 2025/10/02 | 〇 | セクション1.2 CW-UI-035 |  |  |

---

## 4. C. 顧客登録（外部メール自動登録パターン）（統合テスト）

### 4.1 C-1: 外部メールからの自動登録とChatWorkルーム連携

### 基本情報

- **前提条件**: テナント初期セットアップ完了、外部メール連携設定済み

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-INT-062 | 外部メールアドレスからメール受信 | 顧客情報が自動的に作成される | 井上(文) | 2025/10/10 | 〇 |  | 2025/11/27　〇 |  |
| CW-INT-063 | 自動作成された顧客をbizTalkルームに追加 | ルームに顧客が追加される | 井上(文) | 2025/10/10 | 〇 |  | 2025/11/27　〇 |  |
| CW-INT-064 | ChatWorkルーム作成と招待リンク生成 | B-1と同様の手順でルームが作成される | 井上(文) | 2025/10/11 | ×：テナントでの連携設定がなぜか出来ないので修正依頼 | [https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=28977fe36e828038be43ff9f213807ed&pm=s](https://www.notion.so/BUG-CW-OAuth-internal-28977fe36e828038be43ff9f213807ed?pvs=21) | 2025/12/11　〇 |  |
| CW-INT-065 | Webhookとpending contact作成 | B-1と同様にpending contactが作成される |  |  |  |  | ？ | Webhookは利用しない方針になりました |
| CW-INT-066 | 承認フローの確認 | B-1と同様に承認フローが正常に動作する |  |  |  |  | 2025/12/11　〇 |  |

---

## 5. bizTalkルーム作成後のChatWorkルームセットアップ（統合テスト）

### 5.1: 顧客を含むbizTalkルーム作成とChatWork連携設定

### 基本情報

- **前提条件**:
    - テナントのChatWorkアカウント連携済み（2.1または2.1-alt）
    - 顧客登録済み（3. B または 4. C）
- **URL**: `/businesschat`
- **関連処理**: `functions-node22/src/functions/chatworkRoomHelper.ts`
- **統合**: セクション1.2のbizトーク画面UI要素をこのシナリオに統合

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-INT-033 | bizTalkで新規ルームを作成（登録済み顧客を追加） | ルームが正常に作成される | 井上(文) | 2025/10/01 | 〇 |  | 2025/11/02　〇 |  |
| CW-INT-034 | 作成したルームをクリックして開く | ルームのメインビューが表示される | 井上(文) | 2025/10/01 | 〇 |  | 2025/11/02　〇 |  |
| CW-INT-035 | 【UI確認】bizトーク画面の基本表示 | サイドバーに顧客名ごとのルームリストが表示される | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-021 | 2025/11/02　〇 |  |
| CW-INT-036 | 画面右肩の「！」アイコンをクリック | 情報パネル（SubCol）が開く | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-023 | 2025/11/02　〇 |  |
| CW-INT-037 | 【UI確認】情報パネルのタブ表示 | パネル上部に「表示概要」「顧客」「ノート」のタブが表示される | 井上(文) | 2025/10/01 | △(3点セット自体は出ている) | セクション1.2 CW-UI-024

井上:[ノート]を開くと、顧客名のない「様」とだけ書かれたチャット欄へ遷移。 | 2025/11/02　〇 |  |
| CW-INT-038 | 【UI確認】アコーディオンメニュー表示 | 「顧客リスト」「ルーム情報」「メンバーリスト」のアコーディオンが表示される | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-025

井上：顧客/メンバー一覧/ルーム情報 | 2025/11/02　〇 |  |
| CW-INT-039 | 「ルーム情報」アコーディオンを展開 | 外部サービス連携設定の項目が表示される | 井上(文) | 2025/10/01 | 〇 |  | 2025/11/02　〇 | 「連携設定」のアコーディオン |
| CW-INT-040 | 【UI確認】外部サービス連携設定の初期表示 | 未設定アイコンと「未設定」の表示、「設定」ボタンが表示される | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-026 | 2025/11/02　〇 |  |
| CW-INT-041 | 「設定」ボタンをクリック | 「外部サービス連携設定」モーダルが開く | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-027 | 2025/11/02　〇 |  |
| CW-INT-042 | 【UI確認】モーダル内の連携サービス選択 | 「連携サービス」ドロップダウンに「Chatwork」が選択肢として表示される | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-028 | 2025/11/02　〇 |  |
| CW-INT-043 | ドロップダウンで「Chatwork」を選択 | 「Chatwork ルーム選択」フィールドと「ルーム一覧を取得」ボタンが表示される | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-029

井上：[新しいChatworkルームを作成]コマンド有 | 2025/11/02　〇 |  |
| CW-INT-044 | 「ルーム一覧を取得」ボタンをクリック | ChatWorkルーム一覧がドロップダウンに表示される | 井上(文) | 2025/10/01 | 〇 | セクション1.2 CW-UI-030 | 2025/11/02　〇 |  |
| CW-INT-045 | ドロップダウンから既存ルームを選択（または「新規作成」を選択） | ルームIDが選択される | 井上(文) | 2025/10/01 | 〇 |  | 2025/11/20　〇 |  |
| CW-INT-046 | 「設定を保存」ボタンをクリック | 設定が保存され、モーダルが閉じる | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/20　〇 |  |
| CW-INT-047 | 【UI確認】連携設定後の表示 | 外部サービス連携設定にChatWorkアイコンと「Chatwork」が表示される | 井上(文) | 2025/10/02 | 〇 | セクション1.2 CW-UI-026 | 2025/11/20　〇 |  |
| CW-INT-048 | 【UI確認】サイドバーのChatWorkアイコン表示 | ルーム名の下にChatWorkアイコンが表示される | 井上(文) | 2025/10/02 | 〇 | セクション1.2 CW-UI-022 | 2025/11/20　〇 |  |
| CW-INT-049 | 情報パネルの「顧客リスト」アコーディオンを展開 | 顧客リストが表示される |  |  |  |  | 2025/11/20　〇 |  |
| CW-INT-050 | 【UI確認】ChatWork招待ボタン表示（連携済みルーム） | 各顧客の横に「CW招待」ボタンが表示される | 井上(文) | 2025/10/02 | 〇 | セクション1.2 CW-UI-031 | 2025/11/20　〇 |  |

---

## 6. D. 内部メンバーの連携（機能テスト）

### 6.1 D-1: ユーザーの個人認証（OAuth認証方式）

### 基本情報

- **URL**: `/settings/users`
- **関連処理**: `functions-node22/src/userChatWorkAuth.ts`
- **備考**: テナント認証（2.1）と同様のフローだが、Webhook URL設定は不要

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-001 | `/settings/users` にアクセス | アカウント一覧画面が表示される | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/20　〇 |  |
| CW-FUNC-002 | 対象ユーザーの「編集」ボタンをクリック | ユーザー編集モーダルが開く | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/20　〇 |  |
| CW-FUNC-003 | 「連携設定」タブを選択 | 「個人外部サービス連携」セクションが表示される | 井上(文) | 2025/10/02 | 〇 | 井上：タブ名は[外部サービス連携] | 2025/11/20　〇 |  |
| CW-FUNC-004 | Chatwork欄の「設定する」ボタンをクリック | モーダル「Chatwork ユーザー個人認証設定」が開く | 井上(文) | 2025/10/02 | 〇 |  | 2025/11/20　〇 |  |
| CW-FUNC-005 | 【UI確認】「Chatwork側で設定が必要な情報」を展開 | OAuth リダイレクトURLのみ表示され、Webhook URLは表示されない | 井上(文) | 2025/10/02 | 〇 | ユーザー認証ではWebhook不要 | 2025/11/20　〇 |  |
| CW-FUNC-006 | 【外部操作】ChatWork管理画面でOAuthアプリケーションを作成 | リダイレクトURLを設定し、クライアントID/シークレットを取得 |  |  |  | ChatWork側の操作 | 2025/11/20　〇 |  |
| CW-FUNC-007 | 「OAuth認証（セキュア）」を選択 | クライアントID、クライアントシークレット入力フィールド、OAuth認証ボタンが表示される |  |  |  |  | 2025/11/20　〇 |  |
| CW-FUNC-008 | ChatWorkから取得したクライアントID、シークレットを入力 | 各フィールドに正しく入力される |  |  |  |  | 2025/11/20　〇 |  |
| CW-FUNC-009 | 「Chatworkで OAuth認証を開始」ボタンをクリック | ChatWorkのOAuth認証画面（新規ウィンドウ）が開く |  |  |  |  | 2025/11/20　〇 |  |
| CW-FUNC-010 | ChatWork側で認証を許可 | OAuth認証ウィンドウが閉じ、元のモーダルに戻る |  |  |  |  | 2025/11/20　〇 |  |
| CW-FUNC-011 | 【UI確認】OAuth認証完了後の表示 | 「✅ OAuth認証が完了しました」と表示される |  |  |  |  | 2025/11/20　〇 |  |
| CW-FUNC-012 | 「接続をテスト」ボタンをクリック | 接続テストが実行され、成功メッセージが表示される |  |  |  |  | 2025/11/20　〇 |  |
| CW-FUNC-013 | 「保存」ボタンをクリック | 設定が保存され、モーダルが閉じる |  |  |  |  | 2025/11/20　〇 |  |
| CW-FUNC-014 | 設定画面を再読み込み | 連携状態が維持され、連携済み情報が表示される |  |  |  |  | 2025/11/20　〇 |  |

### 6.1-alt D-1-alt: ユーザーの個人認証（APIトークン方式）

### 基本情報

- **URL**: `/settings/users`
- **関連処理**: `functions-node22/src/userChatWorkAuth.ts`
- **備考**: OAuth認証方式（6.1）と比較して簡易だが、全権限でのアクセスとなる

**⚠️ 重要**: このテストを実施する場合、事前に6.1で設定したOAuth認証を削除する必要があります。

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-015 | 【前提】6.1でOAuth設定済みの場合、連携解除を実行 | 連携が解除され、「個人認証」ボタンが表示される |  |  |  | OAuth/APIトークン方式は排他的 | 2025/12/08　〇 |  |
| CW-FUNC-016 | Chatwork欄の「設定する」ボタンをクリック | モーダル「Chatwork ユーザー個人認証設定」が開く |  |  |  |  | 2025/12/08　〇 |  |
| CW-FUNC-017 | 【UI確認】「認証方式」で「APIトークン」を選択 | APIトークン入力フィールドと説明文が表示される |  |  |  |  | 2025/12/08　〇 |  |
| CW-FUNC-018 | 【外部操作】ChatWork管理画面でAPIトークンを発行 | APIトークンを取得 |  |  |  | ChatWork側の操作 | 2025/12/08　〇 |  |
| CW-FUNC-019 | APIトークンを入力 | フィールドに正しく入力される |  |  |  |  | 2025/12/08　〇 |  |
| CW-FUNC-020 | 「接続をテスト」ボタンをクリック | 接続テストが実行され、成功メッセージが表示される |  |  |  |  | 2025/12/08　〇 |  |
| CW-FUNC-021 | 「保存」ボタンをクリック | 設定が保存され、モーダルが閉じる |  |  |  |  | 2025/12/08　〇 |  |
| CW-FUNC-022 | 設定画面を再読み込み | 連携状態が維持され、連携済み情報が表示される |  |  |  |  | 2025/12/08　〇 |  |

### 6.2 D-2: ユーザー個人認証後のメッセージ送信確認

### 基本情報

- **前提条件**: ユーザー個人認証完了（6.1または6.1-alt）

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-023 | bizTalkからメッセージを送信 | メッセージが正常に送信される |  |  |  |  | 2025/12/08　〇 |  |
| CW-FUNC-024 | ChatWork側での送信者名確認 | ChatWork上でユーザー名に表示名プレフィックスが付与されていない |  |  |  | 個人認証ありの場合 | 2025/12/08　〇 |  |

### 6.3 D-3: ユーザーのテナント認証使用（表示名プレフィックス確認）

### 基本情報

- **前提条件**: テナントChatWork連携済み、ユーザー個人認証なし
- **表示名プレフィックスの説明**: テナント認証のみでユーザー個人認証がない場合、ChatWork側のメッセージ先頭に「【follot-bizの表示名】」が自動挿入され、どのfollot-bizユーザーが送信したかを識別できるようにする

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-025 | 個人認証なしでbizTalkからメッセージを送信 | メッセージが正常に送信される |  |  |  |  | 2025/12/08　〇 |  |
| CW-FUNC-026 | ChatWork側での表示名プレフィックス確認 | メッセージ先頭に「【follot-bizユーザーの表示名】」が付与される |  |  |  | 例: 「【田中太郎】こんにちは」 | 2025/12/08　〇 |  |
| CW-FUNC-027 | 複数ユーザーでの動作確認 | 各ユーザーのメッセージに、それぞれのfollot-biz表示名がプレフィックスとして付与される |  |  |  | 送信者識別のため

バグ発見：[https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=28077fe36e82809e8729ee47b4494304&pm=s](https://www.notion.so/BUG-Biz-28077fe36e82809e8729ee47b4494304?pvs=21) | 2025/12/08　△ | [https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=2c377fe36e8280a1a68feffd5ab266cb&pm=s](https://www.notion.so/CW-API-API-CW-Biz-CW-OAuth--2c377fe36e8280a1a68feffd5ab266cb?pvs=21) |

### 6.4 D-4: 未連携アカウントの紐付けフロー

### 基本情報

- **テストURL**: `/external-services-management/chatwork?tab=contacts`
- **前提条件**: テナントのChatWorkアカウント連携済み、bizトークルームとChatWorkルームが連携済み
- **注意**: Phase 2で実装予定の機能を含みます

### 6.4.1 連携承認待ちへの登録

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-028 | 【前提】follot-bizに未登録のChatWorkアカウントを用意 | - | 井上(文) | 2025/10/11 | 〇 | テナントメンバーでも顧客でもないアカウント

>[tester+cw03@coobal.co.jp](mailto:tester+cw03@coobal.co.jp)
>Chatwork ID：irnmxw6ounin | 2025/11/20　〇 | **メールアドレス：tester+11CW01@coobal.co.jp**

Chatwork ID：[20o56eboi0xwg](https://www.chatwork.com/20o56eboi0xwg) |
| CW-FUNC-029 | 用意したChatWorkアカウントで連携済みChatWorkルームにメッセージを送信 | メッセージが送信される | 井上(文) | 2025/10/11 | 〇 | 例: 「こんにちは」

井上：想定されたフローが分からなかったので以下の手順で対応

①FB未連携済垢[tester+cw03@coobal.co.jp]を用意
↓
②FB連携済垢[tester+cw01@coobal.co.jp]で作成したFB連携済CWグループチャットページの上部[招待リンクをコピーする]のURLを[tester+cw03@coobal.co.jp]にログインした状態で押下(tester+cw01垢に参加承諾依頼が飛ぶ)
↓
③tester+cw01ログイン状態でFB連携済CWグループチャットページを見ると承諾依頼が来ていたので許可
↓
④[tester+cw03@coobal.co.jp]垢でFB連携済CWグループチャットに書き込み | 2025/11/20　〇 | 上記のメッセージを無事受信 |
| CW-FUNC-030 | `/external-services-management/chatwork?tab=contacts` にアクセス | 「連携承認待ち」タブが表示される | 井上(文) | 2025/10/11 | 〇 | ↓
⑤FBのメインチャット右上に「連携承認待ち」のポップアップが現れる | 2025/11/20　〇 |  |
| CW-FUNC-031 | 連携承認待ちリストを確認 | 送信したChatWorkアカウント名が表示される | 井上(文) | 2025/10/11 | 〇 |  | 2025/11/20　〇 |  |
| CW-FUNC-032 | 該当アカウントの詳細を確認 | 1. ChatWorkアカウント名が表示される<br>2. 初回メッセージ内容が表示される<br>3. 送信日時が表示される | 井上(文) | 2025/10/11 | 〇 |  | 2025/11/20　〇 |  |

### 6.4.2 推薦機能による紐付け（1顧客のみの場合）

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-033 | 【前提】ChatWorkルームに対応するbizトークルームに未連携顧客が1人のみ存在 | - | 井上(文) | 2025/10/11 | 〇 |  | 2025/11/20　〇 |  |
| CW-FUNC-034 | 連携承認待ちリストで該当アカウントを確認 | 「推薦: 〇〇様」と表示される | 井上(文) | 2025/10/11 | △ | 井上：[推薦～]とは書かれていないが、[こちらの顧客ですか？]と特定のアカウントを挙げている
また、挙げたアカウントに対して[この顧客に紐づける]というボタン有 | 2025/11/20　〇 |  |
| CW-FUNC-035 | 「この顧客に紐付ける」ボタンをクリック | 確認ダイアログが表示される | 井上(文) | 2025/10/11 | 〇 | [CW-FUNC-028：【前提】follot-bizに未登録のChatWorkアカウントを用意]と書いてあるのに、fb側に存在しないアカウントが用意してあるような話になっている

⇒もしかして：(FB側で)FBに未登録のChatworkアカウント(と紐づける顧客情報)を用意……って意味でしょうか？ | 2025/11/20　〇 |  |
| CW-FUNC-036 | 確認ダイアログで「OK」 | 1. 紐付けが完了する<br>2. 成功メッセージが表示される<br>3. 該当アカウントがリストから消える |  |  |  | 上記の事からFB内に対応したアカウントを用意したが、
「この顧客に紐付ける」の対象に紐づけたいアカウントが出てこないため
このアクションを試せない | 2025/11/20　〇 |  |
| CW-FUNC-037 | bizトーク画面で該当ルームを確認 | 過去のメッセージが時系列順に表示される |  |  |  |  | 2025/11/20　〇 |  |
| CW-FUNC-038 | 【確認】紐付けられた顧客がルームメンバーになっているか | 顧客がルームメンバーリストに表示される |  |  |  | ※Phase 2で実装予定 | 2025/11/20　〇 |  |

### 6.4.3 手動紐付け（複数候補がある場合 - 顧客）

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-039 | 【前提】bizトークルームに未連携顧客が複数存在するか、未連携顧客が存在しない | - | 井上(文) | 2025/10/11 | 〇 | 未連携顧客が1件だけ存在するケース以外 | 2025/12/08　〇 |  |
| CW-FUNC-040 | 連携承認待ちリストで該当アカウントを確認 | 「紐付け設定」ボタンが表示される | 井上(文) | 2025/10/11 | 〇 | 推薦なし | 2025/12/08　〇 |  |
| CW-FUNC-041 | 「紐付け設定」ボタンをクリック | 紐付け対象選択モーダルが開く | 井上(文) | 2025/10/11 | 〇 |  | 2025/12/08　〇 |  |
| CW-FUNC-042 | 【確認】モーダル内の「顧客」タブ | テナント全体の未連携顧客がリスト表示される | 井上(文) | 2025/10/11 | 〇 |  | 2025/12/08　〇 |  |
| CW-FUNC-043 | 【確認】モーダル内の「ユーザー」タブ | テナント全体の未連携ユーザーがリスト表示される | 井上(文) | 2025/10/11 | 〇 |  | 2025/12/08　〇 |  |
| CW-FUNC-044 | 顧客タブから該当顧客を選択 | 顧客が選択された状態になる | 井上(文) | 2025/10/11 | 〇 |  | 2025/12/08　〇 |  |
| CW-FUNC-045 | 「紐付ける」ボタンをクリック | 1. 紐付けが完了する<br>2. モーダルが閉じる<br>3. 該当アカウントがリストから消える | 井上(文) | 2025/10/11 | 〇 |  | 2025/12/08　〇 |  |
| CW-FUNC-046 | bizトーク画面で該当ルームを確認 | 過去のメッセージが時系列順に表示される | 井上(文) | 2025/10/11 | △ | 井上：CW側で送ったメッセージ内の改行が、FB側では半角スペースとして処理されている | 2025/12/11　〇 |  |
| CW-FUNC-047 | 【確認】紐付けられた顧客がルームメンバーになっているか | 顧客がルームメンバーリストに表示される | 井上(文) | 2025/10/11 | 〇？ | ※Phase 2で実装予定

井上：概要>サブカラム内[顧客]を開くと上記で連携した顧客が普通に記載されている | 2025/12/11　〇 |  |

### 6.4.4 手動紐付け（ユーザー）

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-048 | 紐付け対象選択モーダルの「ユーザー」タブからユーザーを選択 | ユーザーが選択された状態になる | 井上(文) | 2025/10/11 | 〇 |  | 2025/12/08　〇 |  |
| CW-FUNC-049 | 「紐付ける」ボタンをクリック | IntegrationWizard（個人認証設定画面）が開く | 井上(文) | 2025/10/11 | 〇 |  | 2025/12/08　〇 |  |
| CW-FUNC-050 | IntegrationWizardでOAuth認証またはAPIトークン設定を完了 | 1. 個人認証設定が完了する<br>2. 自動的に紐付け処理が実行される<br>3. モーダルが閉じる | 井上(文) | 2025/10/11 | 〇 | [https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=28977fe36e828038be43ff9f213807ed&pm=s](https://www.notion.so/BUG-CW-OAuth-internal-28977fe36e828038be43ff9f213807ed?pvs=21) | 2025/12/08　〇 |  |
| CW-FUNC-051 | 連携承認待ちリストを確認 | 該当アカウントがリストから消える |  |  |  |  | 2025/12/19　〇 |  |
| CW-FUNC-052 | bizトーク画面で該当ルームを確認 | 過去のメッセージが時系列順に表示される |  |  |  |  |  | [【BUG】ChatWork連携：CW連携したメンバーアカウントでCW連携ルームに入ると、チャット欄が読み込み中から先に進まない](https://www.notion.so/BUG-ChatWork-CW-CW-2c177fe36e8280f09a14daae81333cde?pvs=21) |
| CW-FUNC-053 | 【確認】紐付けられたユーザーがルームメンバーになっているか | ユーザーがルームメンバーリストに表示される |  |  |  | ※Phase 2で実装予定 | 2025/12/19　〇 |  |

### 6.4.5 個人認証済みユーザーの自動認識

**6.4.5-A: ルーム所属ユーザーの自動認識**

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-054 | 【前提】follot-bizユーザーが事前に個人ChatWork認証を設定済み | - |  |  |  | 6.1参照 |  |  |
| CW-FUNC-055 | 【前提】該当ユーザーがbizトークルームのメンバーである | - |  |  |  |  |  |  |
| CW-FUNC-056 | 該当ユーザーがChatWorkからメッセージを送信 | メッセージが送信される |  |  |  |  |  |  |
| CW-FUNC-057 | `/external-services-management/chatwork?tab=contacts` にアクセス | 連携承認待ちリストに該当ユーザーが表示されない |  |  |  | ※Phase 2でデバッグ予定 |  |  |
| CW-FUNC-058 | bizトーク画面で該当ルームを確認 | メッセージが即座に表示される |  |  |  |  |  |  |
| CW-FUNC-059 | 【確認】送信者名 | follot-bizユーザーの表示名が表示される |  |  |  | ChatWork名ではない |  |  |

**6.4.5-B: ルーム非所属ユーザーの扱い（管理者による削除後の再送信）**

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-060 | 【前提】follot-bizユーザーが事前に個人ChatWork認証を設定済み | - |  |  |  | 6.1参照 |  |  |
| CW-FUNC-061 | 【前提】管理者が該当ユーザーをbizトークルームから削除 | ルームメンバーリストから該当ユーザーが消える |  |  |  |  |  |  |
| CW-FUNC-062 | 削除されたユーザーがChatWorkからメッセージを送信 | メッセージが送信される |  |  |  |  |  |  |
| CW-FUNC-063 | `/external-services-management/chatwork?tab=contacts` にアクセス | 連携承認待ちリストに該当ユーザーが表示される |  |  |  | ※Phase 2で実装予定 |  |  |
| CW-FUNC-064 | bizトーク画面で該当ルームを確認 | メッセージが表示されない |  |  |  | 管理者承認待ち |  |  |
| CW-FUNC-065 | 管理者が連携承認待ちから該当ユーザーを承認 | 1. 承認が完了する<br>2. ユーザーがルームメンバーに追加される<br>3. 過去のメッセージが表示される |  |  |  | ※Phase 2で実装予定 |  |  |

---

## 7. E. メッセージング基本機能（機能テスト）

### 7.1 E-1: follot-biz → ChatWork メッセージ送信

### 基本情報

- **関連処理**: `functions-node22/src/sendMessageToChatWork.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-014 | bizTalkでテキストメッセージを入力して送信 | メッセージが正常に送信される |  |  |  |  |  |  |
| CW-FUNC-015 | ChatWork側でメッセージ確認 | メッセージが表示される |  |  |  |  |  |  |
| CW-FUNC-016 | ChatWork側での送信者名確認（個人認証あり） | ChatWork上の名前が表示される（FBの名前ではない） |  |  |  |  |  |  |
| CW-FUNC-017 | ChatWork側での送信者名確認（テナント認証のみ） | メッセージ先頭に「【follot-bizユーザーの表示名】」が付与される |  |  |  | 例: 「【田中太郎】こんにちは」 |  |  |
| CW-FUNC-018 | 長文メッセージの送信 | 長文メッセージが正常に送信・表示される |  |  |  |  |  |  |
| CW-FUNC-019 | 改行を含むメッセージの送信 | 改行が正しく反映される |  |  |  |  |  |  |

### 7.2 E-2: ChatWork → follot-biz メッセージ受信

### 基本情報

- **関連処理**: `functions-node22/src/webhooks/chatwork.ts`, `functions-node22/src/webhooks/shared/messageForwarding.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-020 | ChatWorkでテキストメッセージを送信 | Webhookが正常に受信される |  |  |  |  |  |  |
| CW-FUNC-021 | bizTalk側でメッセージ確認 | メッセージが表示される |  |  |  |  |  |  |
| CW-FUNC-022 | bizTalk側での送信者名確認 | follot-biz上の名前が表示される（CWの名前ではない） |  |  |  |  |  |  |
| CW-FUNC-023 | リアルタイム受信の確認 | メッセージが即座にbizTalkに表示される |  |  |  |  |  |  |

### 7.3 E-3: 連携承認待ちアカウントの承認とメッセージ表示

### 基本情報

- **テストURL**: `/external-services-management/chatwork?tab=contacts`
- **関連処理**: `functions-node22/src/functions/pendingContactApproval.ts`, `functions-node22/src/concerns/createNotificationForPendingContactApproval.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-024 | 【前提】未連携ChatWorkアカウントから複数のメッセージを送信 | ChatWorkからメッセージが送信される |  |  |  | 6.4.1参照 |  |  |
| CW-FUNC-025 | `/external-services-management/chatwork?tab=contacts` にアクセス | 連携承認待ちリストに該当アカウントが表示される |  |  |  |  |  |  |
| CW-FUNC-026 | bizトーク画面を確認 | 未承認メッセージは管理者のみ表示される |  |  |  | admin/owner/manager |  |  |
| CW-FUNC-027 | 一般ユーザーでbizトーク画面を確認 | 未承認メッセージは表示されない |  |  |  | user/guest/customer |  |  |
| CW-FUNC-028 | 管理者が連携承認待ちリストから「承認」ボタンをクリック | 承認確認ダイアログが表示される |  |  |  |  |  |  |
| CW-FUNC-029 | 承認を実行 | 1. 承認成功メッセージが表示される<br>2. 該当アカウントがリストから消える |  |  |  |  |  |  |
| CW-FUNC-030 | bizトーク画面で該当ルームを確認 | 過去のメッセージが時系列順に表示される |  |  |  |  |  |  |
| CW-FUNC-031 | 一般ユーザーでbizトーク画面を確認 | 承認後のメッセージがすべて表示される |  |  |  |  |  |  |
| CW-FUNC-032 | 承認後の双方向メッセージング | 通常通りメッセージが送受信できる |  |  |  |  |  |  |
| CW-FUNC-033 | 承認通知の確認 | 承認者に通知が送信される |  |  |  |  |  |  |

---

## 8. F. メンション機能（機能テスト）

### 8.1 F-1: follot-biz → ChatWork メンション送信

### 基本情報

- **関連処理**: `functions-node22/src/adapters/chatworkAdapter.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-036 | bizTalkでメンション候補リストを表示 | "@"入力時、ルーム所属メンバーと顧客が候補に表示される |  |  |  |  |  |  |
| CW-FUNC-037 | メンション付きメッセージを送信 | メッセージが正常に送信される |  |  |  |  |  |  |
| CW-FUNC-038 | ChatWork側でメンション確認 | [TO] {アイコン} {ChatWork名}さん の形式で表示される |  |  |  |  |  |  |
| CW-FUNC-039 | メンション対象者への通知 | ChatWorkでメンション対象者に通知が届く |  |  |  |  |  |  |
| CW-FUNC-040 | 複数メンションの送信 | 複数ユーザーへのメンションが正常に動作する |  |  |  |  |  |  |

### 8.2 F-2: ChatWork → follot-biz メンション受信

### 基本情報

- **関連処理**: `functions-node22/src/adapters/chatworkAdapter.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-041 | ChatWorkで「TO」ボタンをクリックしメンバーを選択してメンションを送信 | Webhookが正常に受信される |  |  |  |  |  |  |
| CW-FUNC-042 | bizTalk側でメンション確認 | follot-biz形式のメンションに変換されて表示される |  |  |  |  |  |  |
| CW-FUNC-043 | メンション対象者への通知 | follot-bizでメンション対象者に通知が届く |  |  |  |  |  |  |
| CW-FUNC-044 | 複数メンションの受信 | 複数ユーザーへのメンションが正常に変換される |  |  |  |  |  |  |

### 8.3 F-3: メンション候補リストの取得

### 基本情報

- **関連処理**: `src/hooks/useTenantIntegration.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-045 | メッセージ入力欄で"@"を入力 | メンション候補リストが表示される |  |  |  |  |  |  |
| CW-FUNC-046 | 候補リスト内容確認 | ルーム所属メンバーと顧客が表示される |  |  |  |  |  |  |
| CW-FUNC-047 | ルームスコープの確認 | そのルームのメンバーのみが候補に表示される |  |  |  |  |  |  |

---

## 9. G. 引用・添付ファイル機能（機能テスト）

### 9.1 G-1: ChatWork → follot-biz 引用メッセージ受信

### 基本情報

- **関連処理**: `functions-node22/src/adapters/chatworkQuoteAdapter.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-052 | ChatWorkで引用メッセージを送信 | Webhookが正常に受信される | 井上文 | 2025/10/09 | 〇 |  |  |  |
| CW-FUNC-053 | bizTalk側で引用確認 | follot-biz形式の引用として表示される | 井上文 | 2025/10/09 | 〇 |  |  |  |
| CW-FUNC-054 | 引用元メッセージの内容確認 | 引用元の内容が正しく表示される | 井上文 | 2025/10/09 | ×：送信自体は成功しているが添付ファイル付きメッセージを引用した場合に表示崩れ＋αが発生する | [https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=28777fe36e828030aeb2fc649301b507&pm=s](https://www.notion.so/BUG-CW-FB-CW-FB-DL-28777fe36e828030aeb2fc649301b507?pvs=21) |  |  |

### 9.2 G-2: follot-biz → ChatWork ファイル添付

### 基本情報

- **ファイル数制限**: ChatWork連携ルームでは1ファイル/メッセージ（社内スレッドは制限なし）
- **ファイルサイズ制限**: 1GB
- **関連処理**: `functions-node22/src/adapters/chatworkFileAdapter.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-055 | ChatWork連携ルームでファイル添付ボタンをクリック | ファイル選択ダイアログが表示される | 井上文 | 2025/10/09 | 〇 | [https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=28777fe36e828043b3bcc4d99d46485f&pm=s](https://www.notion.so/orBUG-28777fe36e828043b3bcc4d99d46485f?pvs=21) |  |  |
| CW-FUNC-056 | 1ファイル添付して送信 | ファイルが正常にアップロードされ、メッセージが送信される | 井上文 | 2025/10/09 | ×：１ファイル送ってもオウム返しのように返ってくる(FB内で複製している可能性もあり？) |  |  |  |
| CW-FUNC-057 | ChatWork側でファイル確認 | ファイルがダウンロード可能 | 井上文 | 2025/10/09 | 〇 |  |  |  |
| CW-FUNC-058 | 2ファイル同時添付を試行 | 「ChatWork連携ルームでは1つのメッセージに1つのファイルのみ添付できます」とアラートが表示される | 井上文 | 2025/10/09 | 〇 |  |  |  |
| CW-FUNC-059 | 画像ファイルの添付 | 画像が正常に表示される | 井上文 | 2025/10/09 | 〇 |  |  |  |
| CW-FUNC-060 | PDFファイルの添付 | PDFがダウンロード可能 | 井上文 | 2025/10/09 | 〇

ダウンロード自体は可能　詳しくは備考 | [https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=28777fe36e82803e945ee20f536eb6a4&pm=s](https://www.notion.so/BUG-CW-FB-PDF-CW-UI-CW-DL-28777fe36e82803e945ee20f536eb6a4?pvs=21) |  |  |

### 9.3 G-3: ChatWork → follot-biz ファイル受信

### 基本情報

- **ファイルサイズ制限**: 1GB以上のファイルは取り込まれず、メッセージにsuffixが追加される
- **関連処理**: `functions-node22/src/adapters/chatworkFileAdapter.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-FUNC-061 | ChatWorkで小サイズファイル（1MB以下）を添付して送信 | Webhookが正常に受信される | 井上文 | 2025/10/09 | × | [https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=28777fe36e828002a2f6ff51e1123852&pm=s](https://www.notion.so/BUG-CW-FB-CW-28777fe36e828002a2f6ff51e1123852?pvs=21) |  |  |
| CW-FUNC-062 | bizTalk側でファイル確認 | ファイルが表示される | 井上文 | 2025/10/09 | 〇 |  |  |  |
| CW-FUNC-063 | ファイルのダウンロード | ファイルが正常にダウンロードできる | 井上文 | 2025/10/09 | ×：CWのチャット欄とか関係なくファイルのDLが出来なくなってる | [https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=28777fe36e8280f8a208fde0a4c4c3fc&pm=s](https://www.notion.so/BUG-DL-28777fe36e8280f8a208fde0a4c4c3fc?pvs=21) |  |  |
| CW-FUNC-064 | 画像ファイルのプレビュー | 画像が正常にプレビューされる | 井上文 | 2025/10/09 | 〇 |  |  |  |
| CW-FUNC-065 | 1GB以上のファイルを添付して送信 | ファイルは取り込まれず、メッセージに「※添付ファイル「{ファイル名}」({サイズ}MB)はサイズが大きいため受信できませんでした」のsuffixが追加される | 井上文 | 2025/10/09 |  | １GB以上のZIPデータを用意したのだが、CW側でD＆Dした段階で「`アップロードできませんでした
ファイルアップロードが出来ない場合は以下をご確認ください。`」と弾かれてしまった |  |  |

---

## 10. H. エラーハンドリング（エラーテスト）

### 10.1 H-1: ルーム削除時の同期

### 基本情報

- **関連処理**: `functions-node22/src/webhooks/chatwork.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-ERR-001 | ChatWork側でルームを削除 | follot-biz側に削除イベントが通知される |  |  |  |  |  |  |
| CW-ERR-002 | ルーム削除後のステータス確認 | bizTalkルームに「連携解除」の表示がある |  |  |  |  |  |  |
| CW-ERR-003 | 削除後のメッセージ送信試行 | エラーメッセージが表示され、送信できない |  |  |  |  |  |  |
| CW-ERR-004 | 削除通知の確認 | 管理者に通知が送信される |  |  |  |  |  |  |

---

## 11. I. 返信・スレッド機能（機能テスト）

### 11.1 I-1: 社内スレッドの作成と投稿

### 基本情報

- **前提条件**: ChatWork連携済みルーム
- **重要**: 社内スレッドはfollot-biz内で完結し、ChatWorkには送信されない
- **関連処理**: `src/hooks/channels/useDiscussion.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-THREAD-001 | bizトークルームで通常メッセージを表示し、「スレッド開始」ボタンをクリック | スレッド作成モーダルが表示される |  |  |  |  |  |  |
| CW-THREAD-002 | モーダルで「社内スレッド」を選択して作成 | 社内スレッドが作成され、サブカラム（SubCol）に表示される |  |  |  |  |  |  |
| CW-THREAD-003 | 社内スレッド内でメッセージを投稿 | メッセージが社内スレッドに表示される |  |  |  |  |  |  |
| CW-THREAD-004 | ChatWork側の確認 | ChatWork側にメッセージが表示されない（送信されない） |  |  |  |  |  |  |
| CW-THREAD-005 | スレッドヘッダーの表示確認 | 外部スレッド用の背景色が表示されない（通常表示） |  |  |  |  |  |  |

### 11.2 I-2: 外部スレッドの作成と投稿

### 基本情報

- **前提条件**: ChatWork連携済みルーム
- **重要**: 外部スレッドはChatWorkと双方向同期され、`[rp aid=xxx]`タグで連携
- **関連処理**: `functions-node22/src/adapters/chatworkThreadAdapter.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-THREAD-006 | bizトークルームで通常メッセージを表示し、「スレッド開始」ボタンをクリック | スレッド作成モーダルが表示される |  |  |  |  |  |  |
| CW-THREAD-007 | モーダルで「外部スレッド」を選択して作成 | 外部スレッドが作成され、サブカラム（SubCol）に表示される |  |  |  |  |  |  |
| CW-THREAD-008 | スレッドヘッダーの背景色確認 | 外部スレッド用の薄オレンジの背景色が表示される |  |  |  |  |  |  |
| CW-THREAD-009 | 外部スレッド内でメッセージを投稿 | メッセージが外部スレッドに表示される |  |  |  |  |  |  |
| CW-THREAD-010 | ChatWork側でメッセージ確認 | `[rp aid=xxx]`形式で返信として表示される |  |  |  |  |  |  |
| CW-THREAD-011 | ChatWork側での返信表示確認 | スレッド元メッセージへの返信として正しく紐付けられている |  |  |  |  |  |  |

### 11.3 I-3: ChatWork返信 → follot-bizスレッド変換

### 基本情報

- **重要**: ChatWorkの返信機能がfollot-bizの外部スレッドに自動変換される
- **関連処理**: `functions-node22/src/adapters/chatworkThreadAdapter.ts`, `functions-node22/src/webhooks/chatwork.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-THREAD-012 | follot-bizから通常メッセージAを送信 | メッセージがChatWork側に表示される |  |  |  |  |  |  |
| CW-THREAD-013 | ChatWorkでメッセージAに対して返信機能を使用してメッセージBを送信 | ChatWork側で返信として表示される |  |  |  |  |  |  |
| CW-THREAD-014 | follot-biz側でメッセージBの表示確認 | メッセージBが外部スレッドとして表示される |  |  |  |  |  |  |
| CW-THREAD-015 | スレッド元の確認 | メッセージAがスレッド元として紐付けられている |  |  |  |  |  |  |
| CW-THREAD-016 | サブカラム（SubCol）でのスレッド表示 | スレッドがサブカラムで正しく表示される |  |  |  |  |  |  |

### 11.4 I-4: follot-bizスレッド → ChatWork返信送信

### 基本情報

- **重要**: follot-bizの外部スレッドがChatWorkの返信機能に変換される
- **関連処理**: `functions-node22/src/adapters/chatworkThreadAdapter.ts`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-THREAD-017 | ChatWorkから通常メッセージCを送信 | follot-biz側で受信確認される |  |  |  |  |  |  |
| CW-THREAD-018 | follot-bizでメッセージCに対して外部スレッドを作成 | 外部スレッドが作成される |  |  |  |  |  |  |
| CW-THREAD-019 | 外部スレッド内でメッセージDを投稿 | メッセージDがfollot-biz側のスレッドに表示される |  |  |  |  |  |  |
| CW-THREAD-020 | ChatWork側でメッセージDの確認 | `[rp aid=xxx]`形式で表示される |  |  |  |  |  |  |
| CW-THREAD-021 | ChatWorkでの返信表示確認 | メッセージCへの返信として表示される |  |  |  |  |  |  |

### 11.5 I-5: 返信UI表示の確認

### 基本情報

- **コンポーネント**: `src/components/molecules/ReplyInfo/index.tsx`

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-THREAD-022 | follot-bizで外部スレッドを作成してメッセージEを投稿 | メッセージEがChatWorkに送信される |  |  |  |  |  |  |
| CW-THREAD-023 | ChatWork側でメッセージEに対して返信機能でメッセージFを送信 | ChatWork側で返信として表示される |  |  |  |  |  |  |
| CW-THREAD-024 | follot-biz側のメッセージFで返信UI（ReplyInfo）の表示確認 | 返信UIが表示される |  |  |  |  |  |  |
| CW-THREAD-025 | 返信元の表示確認 | 返信元がメッセージEであることが明示される |  |  |  |  |  |  |
| CW-THREAD-026 | 返信元へのジャンプ機能確認 | 返信UIをクリックすると返信元メッセージにジャンプできる（UIで対応している場合） |  |  |  |  |  |  |

### 11.6 I-6: 返信チェーンの追跡

### 基本情報

- **重要**: 複数階層の返信チェーンが正しく追跡される

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-THREAD-027 | follot-bizからメッセージG（通常）を送信 | ChatWork側に表示される |  |  |  |  |  |  |
| CW-THREAD-028 | ChatWorkでメッセージGに返信してメッセージHを送信 | follot-biz側で外部スレッドとして表示される |  |  |  |  |  |  |
| CW-THREAD-029 | follot-bizでメッセージHのスレッドにメッセージIを追加投稿 | ChatWork側でメッセージGへの返信として表示される |  |  |  |  |  |  |
| CW-THREAD-030 | ChatWorkでメッセージIに返信してメッセージJを送信 | follot-biz側で同じスレッド内に表示される |  |  |  |  |  |  |
| CW-THREAD-031 | 返信チェーンの追跡確認 | 全てのメッセージ（H, I, J）が正しいスレッドに紐付けられている |  |  |  |  |  |  |
| CW-THREAD-032 | 最初の外部メッセージの特定確認 | スレッド元がメッセージGとして正しく特定される |  |  |  |  |  |  |

### 11.7 I-7: 社内スレッドがChatWorkに送信されないことの確認

### 基本情報

- **重要**: 社内スレッドは絶対にChatWorkに送信されないことを確認

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-THREAD-033 | follot-bizで社内スレッドを作成 | 社内スレッドが作成される |  |  |  |  |  |  |
| CW-THREAD-034 | 社内スレッド内でメッセージKを投稿 | メッセージKがfollot-biz側の社内スレッドに表示される |  |  |  |  |  |  |
| CW-THREAD-035 | 社内スレッド内で追加メッセージLを投稿 | メッセージLがfollot-biz側の社内スレッドに表示される |  |  |  |  |  |  |
| CW-THREAD-036 | ChatWork側の確認 | ChatWork側にはメッセージK、Lのいずれも表示されない |  |  |  |  |  |  |
| CW-THREAD-037 | follot-biz側での社内スレッド表示確認 | 社内スレッドが正常に表示され、メッセージK、Lが時系列順に表示される |  |  |  |  |  |  |

### 11.8 I-8: 外部スレッドのChatWork同期確認

### 基本情報

- **重要**: 外部スレッドの双方向同期が正しく動作することを確認

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-THREAD-038 | follot-bizで外部スレッドを作成してメッセージMを投稿 | メッセージMがfollot-biz側のスレッドに表示される |  |  |  |  |  |  |
| CW-THREAD-039 | ChatWork側でメッセージMの確認 | `[rp aid=xxx]`形式で返信として表示される |  |  |  |  |  |  |
| CW-THREAD-040 | ChatWorkでメッセージMに返信してメッセージNを送信 | ChatWork側で返信として表示される |  |  |  |  |  |  |
| CW-THREAD-041 | follot-biz側でメッセージNの確認 | メッセージNがスレッド内に表示される |  |  |  |  |  |  |
| CW-THREAD-042 | 双方向同期の確認 | follot-biz ↔ ChatWorkで双方向にメッセージが正しく同期される |  |  |  |  |  |  |
| CW-THREAD-043 | 返信チェーンの整合性確認 | 両サイドで返信チェーンが正しく表示される |  |  |  |  |  |  |

---

## 12. 回帰テスト

### 12.1 既存bizトーク機能への影響確認

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-REG-001 | ChatWork未連携のルームでメッセージ送受信 | 通常通りメッセージが送受信できる |  |  |  |  |  |  |
| CW-REG-002 | ChatWork未連携のルームでファイル添付 | 通常通りファイルが送受信できる |  |  |  |  |  |  |
| CW-REG-003 | 他の外部サービス連携（LINE、Slack等）との共存 | 各サービスが正常に動作する |  |  |  |  |  |  |
| CW-REG-004 | ルーム作成・削除機能 | 通常通りルームが作成・削除できる |  |  |  |  |  |  |
| CW-REG-005 | 顧客管理機能 | 通常通り顧客が管理できる |  |  |  |  |  |  |
| CW-REG-006 | メンバー管理機能 | 通常通りメンバーが管理できる |  |  |  |  |  |  |
| CW-REG-007 | 通知機能 | 通常通り通知が送信される |  |  |  |  |  |  |
| CW-REG-008 | 検索機能 | 通常通り検索ができる |  |  |  |  |  |  |
| CW-REG-009 | ChatWork未連携ルームでのスレッド機能 | 社内スレッドが正常に動作する |  |  |  |  |  |  |

---

## 13. 統合テスト（エンドツーエンド）

### 13.1 完全なChatWork連携フロー

| 項目ID | 操作手順 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-INT-028 | 1. テナント初期セットアップ（A-1, A-2）→ 2. 顧客登録（B-1またはC-1）→ 3. Pending Contact承認（E-3）→ 4. メッセージング（E-1, E-2）→ 5. メンション（F-1, F-2）→ 6. ファイル送受信（G-3, G-4）→ 7. スレッド機能（I-2, I-3, I-4） | 全ステップが正常に動作し、エンドツーエンドのコミュニケーションが成立する |  |  |  |  |  |  |
| CW-INT-029 | 複数ルームでの同時運用 | 各ルームが独立して正常に動作する |  |  |  |  |  |  |
| CW-INT-030 | 複数ユーザーでの同時操作 | 競合なく正常に動作する |  |  |  |  |  |  |

### 13.2 名前表示の統合テスト

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-INT-031 | follot-biz → ChatWork: 個人認証ユーザーのメッセージ送信 | ChatWork上でChatWorkの名前が表示される（FBの名前ではない）、`[FB]`プレフィックスなし |  |  |  |  |  |  |
| CW-INT-032 | follot-biz → ChatWork: テナント認証ユーザーのメッセージ送信 | ChatWork上でChatWorkの名前が表示される、`[FB]`プレフィックスあり |  |  |  |  |  |  |
| CW-INT-033 | ChatWork → follot-biz: メッセージ受信 | follot-biz上でfollot-bizの名前が表示される（CWの名前ではない） |  |  |  |  |  |  |
| CW-INT-034 | メンション時の名前表示 | 各方向で正しい名前が表示される |  |  |  |  |  |  |

---

## 14. バリデーションテスト

### 14.1 入力検証

| 項目ID | 操作/確認内容 | 期待結果 | 実施者 | 実施日 | 結果 | 備考 | 最終アップ後の確認 | 備考 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| CW-VAL-004 | 空メッセージの送信試行 | エラーメッセージが表示される |  |  |  |  |  |  |
| CW-VAL-005 | 極端に長いメッセージの送信 | 適切に処理される、または文字数制限エラーが表示される |  |  |  |  |  |  |
| CW-VAL-006 | 特殊文字を含むメッセージの送信 | 正常に送受信される |  |  |  |  |  |  |
| CW-VAL-007 | 絵文字を含むメッセージの送信 | 正常に送受信される |  |  |  |  |  |  |

---

## テスト環境情報

- **テスト環境URL**: [https://follot-biz--mock-5p17rynz.web.app/](https://follot-biz--mock-5p17rynz.web.app/) など。URLは動的に変更される
- **テストアカウント**: 別途共有
- **ブラウザ**: Chrome最新版、Safari最新版、Edge最新版
- **デバイス**: PC、タブレット、スマートフォン
- **ChatWorkテスト環境**: 開発用ChatWorkアカウント使用

---

## 注意事項

### テスト実施前の準備

1. ChatWork開発用アカウントの準備（テナント用1、個人用1、顧客用2以上）
2. Webhook URLの設定
3. テスト用テナント・ユーザー・顧客アカウントの準備
4. 各ロール（customer, guest, user, manager, admin, owner）のテストアカウント準備

### テスト実施時の注意点

1. **ロール別テスト**: H-5（CW-AUTH-001〜009）は必ず全ロールでテストすること
2. **ルームスコープ**: D-3（CW-FUNC-009〜013）のメンバー連携はルーム内メンバーのみが対象であることを確認
3. **名前表示**: 各方向（FB→CW、CW→FB）で正しい名前が表示されることを確認
4. **Pending Contact**: 承認前後でメッセージの可視性が変わることを確認
5. **スレッド機能**: 社内スレッドと外部スレッドの違いを明確に理解してテストすること
6. **統合テスト**: エンドツーエンドのフロー（CW-INT-028）は必ず実施すること
7. **エラーテスト**: 実環境では実施困難な項目（API認証エラー等）はテスト環境で模擬すること

### データ整合性の確認

- 各テスト後、以下の点をUI上で確認：
    1. メッセージが正しい時系列で表示される
    2. 送信者名が正しく表示される
    3. メンションが正しく機能する
    4. ファイルが正しくダウンロードできる
    5. Pending Contactの状態が正しく管理される
    6. スレッドが正しい親子関係で表示される
    7. 社内スレッドがChatWorkに送信されない
    8. 外部スレッドがChatWorkと双方向同期される

### テスト完了基準

- すべての必須テスト項目（UI、FUNC、AUTH、INT、THREAD）が「合格」となること
- 統合テスト（CW-INT-028）が成功すること
- ロール別権限テスト（CW-AUTH-001〜009）が全ロールで成功すること
- スレッド機能テスト（CW-THREAD-001〜043）が成功すること
- 回帰テスト（CW-REG-001〜009）で既存機能に影響がないこと

| 最終アップ後の確認 | 備考 |
| --- | --- |