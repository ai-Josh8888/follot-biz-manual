# Teamチャット機能

# 【テスト仕様書】Teamチャット機能

## 基本情報

- **作成日**: 2025年8月6日
- **対象バージョン**: リリース前最終版
- **テスト対象**: Teamチャット機能全般（ルーム、DM）

---

## 2. Teamチャット機能 (/workchat)

### 基本情報

- **URL**: `/workchat`, `/workchat/:roomId`, `/workchat/:roomId/threads/:threadId`
- **コンポーネント**: `src/components/environments/WorkChat/`, `src/components/ecosystems/Channel/`, `src/components/organisms/Discussion/`, `src/components/organisms/MessageForm/`, `src/components/organisms/MessagesKit/`
- **機能概要**: 社内メンバー間のリアルタイムコミュニケーションを目的としたチャット機能。ルーム（複数人）とDM（1対1）での会話、スレッドでの深掘り、ファイル共有、メンションなどが可能。

### テスト項目

### 2.1 UI表示テスト

| 項目ID | 確認内容 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T2.1.1 | Teamチャット画面へのアクセス | デフォルトで選択されているルームのメッセージが表示され、サイドバーにチャンネルリスト、中央にメッセージビュー、下部にメッセージ入力フォームが表示されること。 | (25/10/18)井上文 | 〇 | >デフォルトで選択されているルーム

これの設定方法は不明だが一番上のルームの内容が表示されている |
| T2.1.2 | ルーム/DMの切り替え | サイドバーで別のルームまたはDMを選択すると、中央のメッセージビューが選択した対象の内容に正しく切り替わること。 | (25/10/18)井上文 | 〇 |  |
| T2.1.3 | メッセージホバー時のアクション表示 | メッセージにマウスカーソルを合わせると、右肩にアクションボタン（スレッド、絵文字、その他メニュー）が表示されること。 | (25/10/18)井上文 | 〇 |  |
| T2.1.4 | メッセージ送信日時の表示 | メッセージの送信時刻が「5分前」などの相対時間で表示されること。時刻にカーソルを合わせると「8月6日(水) 10:30」のような絶対日時のツールチップが表示されること。 | (25/10/18)井上文 | 〇 |  |
| T2.1.5 | 日付区切り線の表示 | メッセージが日付をまたぐ箇所に「本日」「昨日」「8月5日(火)」などの日付区切り線が表示されること。 | (25/10/18)井上文 | 〇 |  |
| T2.1.6 | メッセージ入力フォームのボタン | フォーム下部に「@（メンション）」「☺（絵文字）」「+（書式設定など）」「AI」の各ボタンが表示されていること。 | (25/10/18)井上文 | × | [https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=29077fe36e8280c39149f0a5f09735ed&pm=s](https://www.notion.so/29077fe36e8280c39149f0a5f09735ed?pvs=21) |
| T2.1.7 | ルームヘッダーの表示 | メッセージビューの上部にルーム名が表示され、右側に「！（ルーム情報）」「...（その他メニュー）」アイコンが表示されること。 | (25/10/18)井上文 | × | 「！」を押下した際の動き
・Biz＆AIトーク：メインチャットとメインカラムがまっさらになってしまう
・Teamチャット：サブカラム内がまっさら。また「！」をもう一度押してもサブカラムが閉じない

いずれにしてもこの状態なのでサブカラム内のパーツの挙動等の確認が取れない |

### 2.2 機能テスト（メッセージ送受信・編集・削除）

| 項目ID | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T2.2.1 | テキストメッセージ送信 | メッセージを送信すると、メッセージビューに即時反映され、他の参加者の画面にもリアルタイムで表示されること。 | (25/10/18)井上文 | 〇 |  |
| T2.2.2 | メッセージ編集 | 自身の送信したメッセージの「...」メニューから「編集」を選択し、内容を修正・保存すると、メッセージが更新され「(編集済)」と表示されること。 | (25/10/18)井上文 | 〇 | `message:edit` `isMyMessage` |
| T2.2.3 | メッセージ取消 | 自身の送信したメッセージの「...」メニューから「取消」を選択すると、メッセージが「(送信を取り消されました)」という表示に変わること。 | (25/10/18)井上文 | 〇 | `message:revoke` `isMyMessage` |
| T2.2.4 | メッセージ復元 | 「取消」したメッセージの「...」メニューから「復元」を選択すると、元のメッセージ内容が再度表示されること。 | (25/10/18)井上文 | 〇 | `unRevokeMessage` |
| T2.2.5 | メッセージ削除 | 「取消」済みのメッセージの「...」メニューから「削除」を選択すると、メッセージが完全にUIから削除されること。 | (25/10/18)井上文 | 〇 | `message:delete` |
| T2.2.6 | URL自動リンク化 | メッセージ内にURL（http/https）を記述して送信すると、自動的にクリック可能なリンクとして表示されること。 | (25/10/18)井上文 | × | URLは確かにクリックすればいいようになっているが、プレビューが本番に上がっているものと異なっている

正直、現状の開発のサイズ感で良いと思うが、プレビュー内のヘッダーに誂えられたサイトロゴ画像がややはみ出ているのでそこは修正して欲しい |
| T2.2.7 | 絵文字リアクション | メッセージに絵文字でリアクションすると、その絵文字とカウントがメッセージ下部に表示されること。同じリアクションを再度クリックすると解除されること。 | (25/10/18)井上文 | 〇 |  |

### 2.3 機能テスト（入力フォーム）

| 項目ID | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T2.3.1 | 「@」メンションボタン | 「@」ボタンを押すとメンション候補が表示され、ユーザーを選択すると入力欄に「@ユーザー名」が挿入されること。 | (25/10/19)井上文 | 〇 | 問題なく出てくるが、文字だけで、特にメンション先のアイコン画像などはないが問題ないか |
| T2.3.2 | 「☺」絵文字ボタン | 「☺」ボタンを押すと絵文字ピッカーが表示され、絵文字を選択するとカーソル位置に入力されること。 | (25/10/19)井上文 | 〇？ | >カーソル位置に入力されること。

これの意味がよく分からない |
| T2.3.3 | 「+」ボタン（書式設定） | 「+」ボタンを押すと、太字や斜体などの書式設定ツールバーが表示されること。再度押すと非表示になること。 | (25/10/19)井上文 | × | T2.1.6で取り上げた内容と同じ |
| T2.3.4 | 「AI」ボタン | 「AI」ボタンを押すとプロンプト選択のポップオーバーが表示され、プロンプトを選択・実行すると生成された文章が入力欄に挿入されること。 | (25/10/19)井上文 | ？ | 「プロンプトが設定されていません」と出る
設定方法が不明 |
| T2.3.5 | 下書き機能 | メッセージを入力中に別のルームへ移動し、再度元のルームに戻ると、入力途中の文章と添付ファイルがフォームに復元されていること。 | (25/10/19)井上文 | × | 文章は維持されるが、添付ファイルは維持されない |

### 2.4 機能テスト（ルーム・スレッド）

| 項目ID | 操作 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- |
| T2.4.1 | 新規ルーム作成 | サイドバーから新しいルームを作成できること。公開/非公開設定、メンバー招待が正しく機能すること。 | (25/10/19)井上文 | △ | ルーム作成時に存在するのは[**ルーム名/説明(任意)/メンバー]**の３つしかなく、本番FB含め[公開/非公開]といった機能は確認出来ない

[https://www.notion.so/da726d34a9684f2ca15ec6aab033fc2f?v=1d277fe36e828085bd31000cc6db4a03&p=29077fe36e8280caaaebdcea49445e5d&pm=s](https://www.notion.so/BUG-29077fe36e8280caaaebdcea49445e5d?pvs=21)
通知に招待が来ているかは不明だが、メンバーとして設定された垢でルームには参加できている |
| T2.4.2 | スレッドでの返信 | メッセージのアクションボタンから「スレッドで返信する」を選ぶと、右側にスレッドビューが開き、そこで会話を継続できること。 | (25/10/19)井上文 | × | T2.1.7と関連して、サブカラムの中身がまっさらなのでテストが出来ない |
| T2.4.3 | 日付区切り線のジャンプ機能 | 日付区切り線をクリックすると、「今日」「昨日」「先週」などにジャンプするメニューが表示され、選択した日付のメッセージまでスクロールすること。 | (25/10/19)井上文 | 〇？ | >選択した日付のメッセージまでスクロールすること。

 |

### 2.5 権限テスト

| 項目ID | ユーザーロール | 操作/確認箇所 | 期待結果 | 実施者 | 結果 | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| T2.5.1 | ユーザー (`User`) | 他ユーザーのメッセージ | 「...」メニュー内に「編集」「取消」が表示されないこと。 | (25/10/19)井上文 | △？ | `isMyMessage`
そもそも[…]メニューが投稿者以外のアカウントからは確認できない

また、[リアクション追加][スレッド開始][タスク追加]の三つをカーソルが行き来すると、切り替わる瞬間に読み込んでいるのか画面がガタつく |
| T2.5.2 | 運用管理者 (`Manager`) | 他ユーザーのメッセージ | 「...」メニュー内に「編集」「取消」が表示され、操作可能であること。 | (25/10/19)井上文 | 〇 | `static`権限 |
| T2.5.3 | 運用管理者 (`Manager`) | 取消済メッセージの削除 | 他ユーザーが取り消したメッセージでも、「削除」が可能であること。 | (25/10/19)井上文 | × | `message:delete`

Sys_Bun(管理者/クーバル権限)でメッセージを投下→自分で「取消」をしてから、運用管理者アカウントで[…]をクリックしたら[編集][復元]しか存在しなかった |
| T2.5.4 | Teamチャットゲスト (`Guest`) | メッセージの編集・取消 | 自分のメッセージに限り、編集・取消が可能であること。 | (25/10/19)井上文 | 〇 | `isMyMessage`

他の３権限のコメントにはリアクションしかできない/[取消]は出来るが、削除は出来ない |
| T2.5.5 | **クーバル権限** (`isSuperAdmin: true`) | すべてのメッセージ操作 | ロールに関わらず、すべてのメッセージの編集・取消・削除が実行可能であること。 | (25/10/19)井上文 | × | `isSuperAdmin` 
編集・取消・削除については可能だが、時折入力した選択肢を実行しない時がある
※本番環境もそう。取消⇆復元を繰り返していたりすると発生が確認できると思う

メッセージが入力フォームの真上まで伸びてきていると、一番最新のメッセージで[…]を押すと、背景が透けたコマンドが表示される |